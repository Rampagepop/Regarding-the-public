Format=function(t,e){this.editorUi=t,this.container=e},Format.prototype.labelIndex=0,Format.prototype.currentIndex=0,Format.prototype.showCloseButton=!0,Format.prototype.inactiveTabBackgroundColor="#f1f3f4",Format.prototype.roundableShapes=["label","rectangle","internalStorage","corner","parallelogram","swimlane","triangle","trapezoid","ext","step","tee","process","link","rhombus","offPageConnector","loopLimit","hexagon","manualInput","curlyBracket","singleArrow","callout","doubleArrow","flexArrow","card","umlLifeline"],Format.prototype.init=function(){var t=this.editorUi.editor.graph;this.update=mxUtils.bind(this,function(t,e){this.clearSelectionState(),this.refresh()}),t.getSelectionModel().addListener(mxEvent.CHANGE,this.update),t.addListener(mxEvent.EDITING_STARTED,this.update),t.addListener(mxEvent.EDITING_STOPPED,this.update),t.getModel().addListener(mxEvent.CHANGE,this.update),t.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){}))},Format.prototype.clearSelectionState=function(){this.selectionState=null},Format.prototype.getSelectionState=function(){return null==this.selectionState&&(this.selectionState=this.createSelectionState()),this.selectionState},Format.prototype.createSelectionState=function(){for(var t=this.editorUi.editor.graph.getSelectionCells(),e=this.initSelectionState(),n=0;n<t.length;n++)this.updateSelectionStateForCell(e,t[n],t);return e},Format.prototype.initSelectionState=function(){return{vertices:[],edges:[],x:null,y:null,width:null,height:null,style:{},containsImage:!1,containsLabel:!1,fill:!0,glass:!0,rounded:!0,comic:!0,autoSize:!1,image:!0,shadow:!0,lineJumps:!0}},Format.prototype.updateSelectionStateForCell=function(t,e,n){var i=this.editorUi.editor.graph;if(i.getModel().isVertex(e)){t.vertices.push(e);var l=i.getCellGeometry(e);if(null!=l&&(l.width>0?null==t.width?t.width=l.width:t.width!=l.width&&(t.width=""):t.containsLabel=!0,l.height>0?null==t.height?t.height=l.height:t.height!=l.height&&(t.height=""):t.containsLabel=!0,!l.relative||null!=l.offset)){var s=l.relative?l.offset.x:l.x,o=l.relative?l.offset.y:l.y;null==t.x?t.x=s:t.x!=s&&(t.x=""),null==t.y?t.y=o:t.y!=o&&(t.y="")}}else i.getModel().isEdge(e)&&t.edges.push(e);var a=i.view.getState(e);if(null!=a){t.autoSize=t.autoSize||this.isAutoSizeState(a),t.glass=t.glass&&this.isGlassState(a),t.rounded=t.rounded&&this.isRoundedState(a),t.lineJumps=t.lineJumps&&this.isLineJumpState(a),t.comic=t.comic&&this.isComicState(a),t.image=t.image&&this.isImageState(a),t.shadow=t.shadow&&this.isShadowState(a),t.fill=t.fill&&this.isFillState(a);var r=mxUtils.getValue(a.style,mxConstants.STYLE_SHAPE,null);for(var d in t.containsImage=t.containsImage||"image"==r,a.style){var u=a.style[d];null!=u&&(null==t.style[d]?t.style[d]=u:t.style[d]!=u&&(t.style[d]=""))}}},Format.prototype.isFillState=function(t){return t.view.graph.model.isVertex(t.cell)||"arrow"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)||"filledEdge"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)||"flexArrow"==mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)},Format.prototype.isGlassState=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return"label"==e||"rectangle"==e||"internalStorage"==e||"ext"==e||"umlLifeline"==e||"swimlane"==e||"process"==e},Format.prototype.isRoundedState=function(t){return null!=t.shape?t.shape.isRoundable():mxUtils.indexOf(this.roundableShapes,mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null))>=0},Format.prototype.isLineJumpState=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return!mxUtils.getValue(t.style,mxConstants.STYLE_CURVED,!1)&&("connector"==e||"filledEdge"==e)},Format.prototype.isComicState=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return mxUtils.indexOf(["label","rectangle","internalStorage","corner","parallelogram","note","collate","swimlane","triangle","trapezoid","ext","step","tee","process","link","rhombus","offPageConnector","loopLimit","hexagon","manualInput","singleArrow","doubleArrow","flexArrow","filledEdge","card","umlLifeline","connector","folder","component","sortShape","cross","umlFrame","cube","isoCube","isoRectangle","partialRectangle"],e)>=0},Format.prototype.isAutoSizeState=function(t){return"1"==mxUtils.getValue(t.style,mxConstants.STYLE_AUTOSIZE,null)},Format.prototype.isImageState=function(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null);return"label"==e||"image"==e},Format.prototype.isShadowState=function(t){return"image"!=mxUtils.getValue(t.style,mxConstants.STYLE_SHAPE,null)},Format.prototype.clear=function(){if(this.container.innerHTML="",null!=this.panels)for(var t=0;t<this.panels.length;t++)this.panels[t].destroy();this.panels=[]},Format.prototype.refresh=function(){if("0px"!=this.container.style.width){this.clear();var t=this.editorUi,e=t.editor.graph,n=document.createElement("div");n.style.whiteSpace="nowrap",n.style.color="rgb(112, 112, 112)",n.style.textAlign="left",n.style.cursor="default";var i=document.createElement("div");if(i.className="geFormatSection",i.style.textAlign="center",i.style.fontWeight="bold",i.style.paddingTop="8px",i.style.fontSize="13px",i.style.borderWidth="0px 0px 1px 1px",i.style.borderStyle="solid",i.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",i.style.height=mxClient.IS_QUIRKS?"34px":"25px",i.style.overflow="hidden",i.style.width="100%",this.container.appendChild(n),mxEvent.addListener(i,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),e.isSelectionEmpty()){if(mxUtils.write(i,mxResources.get("diagram")),i.style.borderLeftWidth="0px",this.showCloseButton){var l=document.createElement("img");l.setAttribute("border","0"),l.setAttribute("src",Dialog.prototype.closeImage),l.setAttribute("title",mxResources.get("hide")),l.style.position="absolute",l.style.display="block",l.style.right="0px",l.style.top="8px",l.style.cursor="pointer",l.style.marginTop="1px",l.style.marginRight="17px",l.style.border="1px solid transparent",l.style.padding="1px",l.style.opacity=.5,i.appendChild(l),mxEvent.addListener(l,"click",function(){t.actions.get("formatPanel").funct()})}n.appendChild(i),this.panels.push(new DiagramFormatPanel(this,t,n))}else if(e.isEditing())mxUtils.write(i,mxResources.get("text")),n.appendChild(i),this.panels.push(new TextFormatPanel(this,t,n));else{var s=this.getSelectionState().containsLabel,o=null,a=null,r=mxUtils.bind(this,function(t,e,n){var i=mxUtils.bind(this,function(i){o!=t&&(s?this.labelIndex=n:this.currentIndex=n,null!=o&&(o.style.backgroundColor=this.inactiveTabBackgroundColor,o.style.borderBottomWidth="1px"),(o=t).style.backgroundColor="",o.style.borderBottomWidth="0px",a!=e&&(null!=a&&(a.style.display="none"),(a=e).style.display=""))});mxEvent.addListener(t,"click",i),mxEvent.addListener(t,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),n==(s?this.labelIndex:this.currentIndex)&&i()}),d=0;i.style.backgroundColor=this.inactiveTabBackgroundColor,i.style.borderLeftWidth="1px",i.style.cursor="pointer",i.style.width=s?"50%":"33.3%",i.style.width=s?"50%":"33.3%";var u=i.cloneNode(!1),p=u.cloneNode(!1);if(u.style.backgroundColor=this.inactiveTabBackgroundColor,p.style.backgroundColor=this.inactiveTabBackgroundColor,s)u.style.borderLeftWidth="0px";else{i.style.borderLeftWidth="0px",mxUtils.write(i,mxResources.get("style")),n.appendChild(i);var m=n.cloneNode(!1);m.style.display="none",this.panels.push(new StyleFormatPanel(this,t,m)),this.container.appendChild(m),r(i,m,d++)}mxUtils.write(u,mxResources.get("text")),n.appendChild(u);var c=n.cloneNode(!1);c.style.display="none",this.panels.push(new TextFormatPanel(this,t,c)),this.container.appendChild(c),mxUtils.write(p,mxResources.get("arrange")),n.appendChild(p);var g=n.cloneNode(!1);g.style.display="none",this.panels.push(new ArrangePanel(this,t,g)),this.container.appendChild(g),r(u,c,d++),r(p,g,d++)}}},BaseFormatPanel=function(t,e,n){this.format=t,this.editorUi=e,this.container=n,this.listeners=[]},BaseFormatPanel.prototype.buttonBackgroundColor="white",BaseFormatPanel.prototype.getSelectionState=function(){for(var t=this.editorUi.editor.graph,e=t.getSelectionCells(),n=null,i=0;i<e.length;i++){var l=t.view.getState(e[i]);if(null!=l){var s=mxUtils.getValue(l.style,mxConstants.STYLE_SHAPE,null);if(null!=s)if(null==n)n=s;else if(n!=s)return null}}return n},BaseFormatPanel.prototype.installInputHandler=function(t,e,n,i,l,s,o,a){s=null!=s?s:"",a=null!=a&&a;var r=this.editorUi,d=r.editor.graph;i=null!=i?i:1,l=null!=l?l:999;var u=null,p=!1,m=mxUtils.bind(this,function(m){var c=a?parseFloat(t.value):parseInt(t.value);if(isNaN(c)||e!=mxConstants.STYLE_ROTATION||(c=mxUtils.mod(Math.round(100*c),36e3)/100),c=Math.min(l,Math.max(i,isNaN(c)?n:c)),d.cellEditor.isContentEditing()&&o)p||(p=!0,null!=u&&(d.cellEditor.restoreSelection(u),u=null),o(c),t.value=c+s,p=!1);else if(c!=mxUtils.getValue(this.format.getSelectionState().style,e,n)){d.isEditing()&&d.stopEditing(!0),d.getModel().beginUpdate();try{d.setCellStyles(e,c,d.getSelectionCells()),e==mxConstants.STYLE_FONTSIZE&&d.updateLabelElements(d.getSelectionCells(),function(t){t.style.fontSize=c+"px",t.removeAttribute("size")}),r.fireEvent(new mxEventObject("styleChanged","keys",[e],"values",[c],"cells",d.getSelectionCells()))}finally{d.getModel().endUpdate()}}t.value=c+s,mxEvent.consume(m)});return o&&d.cellEditor.isContentEditing()&&(mxEvent.addListener(t,"mousedown",function(){document.activeElement==d.cellEditor.textarea&&(u=d.cellEditor.saveSelection())}),mxEvent.addListener(t,"touchstart",function(){document.activeElement==d.cellEditor.textarea&&(u=d.cellEditor.saveSelection())})),mxEvent.addListener(t,"change",m),mxEvent.addListener(t,"blur",m),m},BaseFormatPanel.prototype.createPanel=function(){var t=document.createElement("div");return t.className="geFormatSection",t.style.padding="12px 0px 12px 18px",t},BaseFormatPanel.prototype.createTitle=function(t){var e=document.createElement("div");return e.style.padding="0px 0px 6px 0px",e.style.whiteSpace="nowrap",e.style.overflow="hidden",e.style.width="200px",e.style.fontWeight="bold",mxUtils.write(e,t),e},BaseFormatPanel.prototype.createStepper=function(t,e,n,i,l,s,o){n=null!=n?n:1,i=null!=i?i:8,mxClient.IS_QUIRKS?i-=2:(mxClient.IS_MT||document.documentMode>=8)&&(i+=1);var a=document.createElement("div");mxUtils.setPrefixedStyle(a.style,"borderRadius","3px"),a.style.border="1px solid rgb(192, 192, 192)",a.style.position="absolute";var r=document.createElement("div");r.style.borderBottom="1px solid rgb(192, 192, 192)",r.style.position="relative",r.style.height=i+"px",r.style.width="10px",r.className="geBtnUp",a.appendChild(r);var d=r.cloneNode(!1);if(d.style.border="none",d.style.height=i+"px",d.className="geBtnDown",a.appendChild(d),mxEvent.addListener(d,"click",function(i){""==t.value&&(t.value=s||"2");var l=o?parseFloat(t.value):parseInt(t.value);isNaN(l)||(t.value=l-n,null!=e&&e(i)),mxEvent.consume(i)}),mxEvent.addListener(r,"click",function(i){""==t.value&&(t.value=s||"0");var l=o?parseFloat(t.value):parseInt(t.value);isNaN(l)||(t.value=l+n,null!=e&&e(i)),mxEvent.consume(i)}),l){var u=null;mxEvent.addGestureListeners(a,function(t){(mxClient.IS_QUIRKS||8==document.documentMode)&&(u=document.selection.createRange()),mxEvent.consume(t)},null,function(t){if(null!=u){try{u.select()}catch(t){}u=null,mxEvent.consume(t)}})}return a},BaseFormatPanel.prototype.createOption=function(t,e,n,i){var l=document.createElement("div");l.style.padding="6px 0px 1px 0px",l.style.whiteSpace="nowrap",l.style.overflow="hidden",l.style.width="200px",l.style.height=mxClient.IS_QUIRKS?"27px":"18px";var s=document.createElement("input");s.setAttribute("type","checkbox"),s.style.margin="0px 6px 0px 0px",l.appendChild(s);var o=document.createElement("span");mxUtils.write(o,t),l.appendChild(o);var a=!1,r=e(),d=function(t){a||(a=!0,t?(s.setAttribute("checked","checked"),s.defaultChecked=!0,s.checked=!0):(s.removeAttribute("checked"),s.defaultChecked=!1,s.checked=!1),r!=t&&(r=t,e()!=r&&n(r)),a=!1)};return mxEvent.addListener(l,"click",function(t){if("disabled"!=s.getAttribute("disabled")){var e=mxEvent.getSource(t);e!=l&&e!=o||(s.checked=!s.checked),d(s.checked)}}),d(r),null!=i&&(i.install(d),this.listeners.push(i)),l},BaseFormatPanel.prototype.createCellOption=function(t,e,n,i,l,s,o,a){i=null!=i?"null"==i?null:i:"1",l=null!=l?"null"==l?null:l:"0";var r=this.editorUi,d=r.editor.graph;return this.createOption(t,function(){var t=d.view.getState(d.getSelectionCell());return null!=t?mxUtils.getValue(t.style,e,n)!=l:null},function(t){if(a&&d.stopEditing(),null!=o)o.funct();else{d.getModel().beginUpdate();try{var n=t?i:l;d.setCellStyles(e,n,d.getSelectionCells()),null!=s&&s(d.getSelectionCells(),n),r.fireEvent(new mxEventObject("styleChanged","keys",[e],"values",[n],"cells",d.getSelectionCells()))}finally{d.getModel().endUpdate()}}},{install:function(t){this.listener=function(){var i=d.view.getState(d.getSelectionCell());null!=i&&t(mxUtils.getValue(i.style,e,n)!=l)},d.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){d.getModel().removeListener(this.listener)}})},BaseFormatPanel.prototype.createColorOption=function(t,e,n,i,l,s,o){var a=document.createElement("div");a.style.padding="6px 0px 1px 0px",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.width="200px",a.style.height=mxClient.IS_QUIRKS?"27px":"18px";var r=document.createElement("input");r.setAttribute("type","checkbox"),r.style.margin="0px 6px 0px 0px",o||a.appendChild(r);var d=document.createElement("span");mxUtils.write(d,t),a.appendChild(d);var u=e(),p=!1,m=null,c=function(t,l,a){p||(p=!0,t=/(^#?[a-zA-Z0-9]*$)/.test(t)?t:i,m.innerHTML='<div style="width:'+(mxClient.IS_QUIRKS?"30":"36")+"px;height:12px;margin:3px;border:1px solid black;background-color:"+mxUtils.htmlEntities(null!=t&&t!=mxConstants.NONE?t:i)+';"></div>',(mxClient.IS_QUIRKS||8==document.documentMode)&&(m.firstChild.style.margin="0px"),null!=t&&t!=mxConstants.NONE?(r.setAttribute("checked","checked"),r.defaultChecked=!0,r.checked=!0):(r.removeAttribute("checked"),r.defaultChecked=!1,r.checked=!1),m.style.display=r.checked||o?"":"none",null!=s&&s(t),l||(u=t,(a||o||e()!=u)&&n(u)),p=!1)};return(m=mxUtils.button("",mxUtils.bind(this,function(t){this.editorUi.pickColor(u,function(t){c(t,null,!0)}),mxEvent.consume(t)}))).style.position="absolute",m.style.marginTop="-4px",m.style.right=mxClient.IS_QUIRKS?"0px":"20px",m.style.height="22px",m.className="geColorBtn",m.style.display=r.checked||o?"":"none",a.appendChild(m),mxEvent.addListener(a,"click",function(t){var e=mxEvent.getSource(t);e!=r&&"INPUT"==e.nodeName||(e!=r&&(r.checked=!r.checked),r.checked||null==u||u==mxConstants.NONE||i==mxConstants.NONE||(i=u),c(r.checked?i:mxConstants.NONE))}),c(u,!0),null!=l&&(l.install(c),this.listeners.push(l)),a},BaseFormatPanel.prototype.createCellColorOption=function(t,e,n,i,l){var s=this.editorUi,o=s.editor.graph;return this.createColorOption(t,function(){var t=o.view.getState(o.getSelectionCell());return null!=t?mxUtils.getValue(t.style,e,null):null},function(t){o.getModel().beginUpdate();try{null!=l&&l(t),o.setCellStyles(e,t,o.getSelectionCells()),s.fireEvent(new mxEventObject("styleChanged","keys",[e],"values",[t],"cells",o.getSelectionCells()))}finally{o.getModel().endUpdate()}},n||mxConstants.NONE,{install:function(t){this.listener=function(){var n=o.view.getState(o.getSelectionCell());null!=n&&t(mxUtils.getValue(n.style,e,null))},o.getModel().addListener(mxEvent.CHANGE,this.listener)},destroy:function(){o.getModel().removeListener(this.listener)}},i)},BaseFormatPanel.prototype.addArrow=function(t,e){e=null!=e?e:10;var n=document.createElement("div");n.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",n.style.padding="6px",n.style.paddingRight="4px";var i=10-e;2==i?n.style.paddingTop="6px":i>0?n.style.paddingTop=6-i+"px":n.style.marginTop="-2px",n.style.height=e+"px",n.style.borderLeft="1px solid #a0a0a0",n.innerHTML='<img border="0" src="'+(mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHBJREFUeNpidHB2ZyAGsACxDRBPIKCuA6TwCBB/h2rABu4A8SYmKCcXiP/iUFgAxL9gCi8A8SwsirZCMQMTkmANEH9E4v+CmsaArvAdyNFI/FlQ92EoBIE+qCRIUz168DBgsU4OqhinQpgHMABAgAEALY4XLIsJ20oAAAAASUVORK5CYII=":IMAGE_PATH+"/dropdown.png")+'" style="margin-bottom:4px;">',mxUtils.setOpacity(n,70);var l=t.getElementsByTagName("div")[0];return null!=l&&(l.style.paddingRight="6px",l.style.marginLeft="4px",l.style.marginTop="-1px",l.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",mxUtils.setOpacity(l,60)),mxUtils.setOpacity(t,100),t.style.border="1px solid #a0a0a0",t.style.backgroundColor=this.buttonBackgroundColor,t.style.backgroundImage="none",t.style.width="auto",t.className+=" geColorBtn",mxUtils.setPrefixedStyle(t.style,"borderRadius","3px"),t.appendChild(n),l},BaseFormatPanel.prototype.addUnitInput=function(t,e,n,i,l,s,o,a,r){o=null!=o?o:0;var d=document.createElement("input");d.style.position="absolute",d.style.textAlign="right",d.style.marginTop="-2px",d.style.right=n+12+"px",d.style.width=i+"px",t.appendChild(d);var u=this.createStepper(d,l,s,null,a,null,r);return u.style.marginTop=o-2+"px",u.style.right=n+"px",t.appendChild(u),d},BaseFormatPanel.prototype.createRelativeOption=function(t,e,n,i,l){n=null!=n?n:44;var s=this.editorUi.editor.graph,o=this.createPanel();o.style.paddingTop="10px",o.style.paddingBottom="10px",mxUtils.write(o,t),o.style.fontWeight="bold";var a=mxUtils.bind(this,function(t){if(null!=i)i(r);else{var n=parseInt(r.value);n=Math.min(100,Math.max(0,isNaN(n)?100:n));var l=s.view.getState(s.getSelectionCell());null!=l&&n!=mxUtils.getValue(l.style,e,100)&&(100==n&&(n=null),s.setCellStyles(e,n,s.getSelectionCells()),this.editorUi.fireEvent(new mxEventObject("styleChanged","keys",[e],"values",[n],"cells",s.getSelectionCells()))),r.value=(null!=n?n:"100")+" %"}mxEvent.consume(t)}),r=this.addUnitInput(o,"%",20,n,a,10,-15,null!=i);if(null!=e){var d=mxUtils.bind(this,function(t,n,i){if(i||r!=document.activeElement){var l=this.format.getSelectionState(),s=parseInt(mxUtils.getValue(l.style,e,100));r.value=isNaN(s)?"":s+" %"}});mxEvent.addListener(r,"keydown",function(t){13==t.keyCode?(s.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(d(null,null,!0),s.container.focus(),mxEvent.consume(t))}),s.getModel().addListener(mxEvent.CHANGE,d),this.listeners.push({destroy:function(){s.getModel().removeListener(d)}}),d()}return mxEvent.addListener(r,"blur",a),mxEvent.addListener(r,"change",a),null!=l&&l(r),o},BaseFormatPanel.prototype.addLabel=function(t,e,n,i){i=null!=i?i:61;var l=document.createElement("div");mxUtils.write(l,e),l.style.position="absolute",l.style.right=n+"px",l.style.width=i+"px",l.style.marginTop="6px",l.style.textAlign="center",t.appendChild(l)},BaseFormatPanel.prototype.addKeyHandler=function(t,e){mxEvent.addListener(t,"keydown",mxUtils.bind(this,function(t){13==t.keyCode?(this.editorUi.editor.graph.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(null!=e&&e(null,null,!0),this.editorUi.editor.graph.container.focus(),mxEvent.consume(t))}))},BaseFormatPanel.prototype.styleButtons=function(t){for(var e=0;e<t.length;e++)mxUtils.setPrefixedStyle(t[e].style,"borderRadius","3px"),mxUtils.setOpacity(t[e],100),t[e].style.border="1px solid #a0a0a0",t[e].style.padding="4px",t[e].style.paddingTop="3px",t[e].style.paddingRight="1px",t[e].style.margin="1px",t[e].style.width="24px",t[e].style.height="20px",t[e].className+=" geColorBtn"},BaseFormatPanel.prototype.destroy=function(){if(null!=this.listeners){for(var t=0;t<this.listeners.length;t++)this.listeners[t].destroy();this.listeners=null}},ArrangePanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(ArrangePanel,BaseFormatPanel),ArrangePanel.prototype.init=function(){this.editorUi.editor.graph;var t=this.format.getSelectionState();if(this.container.appendChild(this.addLayerOps(this.createPanel())),this.addGeometry(this.container),this.addEdgeGeometry(this.container),t.containsLabel&&0!=t.edges.length||this.container.appendChild(this.addAngle(this.createPanel())),t.containsLabel||0!=t.edges.length||this.container.appendChild(this.addFlip(this.createPanel())),t.vertices.length>1&&(this.container.appendChild(this.addAlign(this.createPanel())),this.container.appendChild(this.addDistribute(this.createPanel()))),this.container.appendChild(this.addGroupOps(this.createPanel())),t.containsLabel){var e=document.createElement("div");e.style.width="100%",e.style.marginTop="0px",e.style.fontWeight="bold",e.style.padding="10px 0 0 18px",mxUtils.write(e,mxResources.get("style")),this.container.appendChild(e),new StyleFormatPanel(this.format,this.editorUi,this.container)}},ArrangePanel.prototype.addLayerOps=function(t){var e,n=this.editorUi;return(e=mxUtils.button(mxResources.get("toFront"),function(t){n.actions.get("toFront").funct()})).setAttribute("title",mxResources.get("toFront")+" ("+this.editorUi.actions.get("toFront").shortcut+")"),e.style.width="100px",e.style.marginRight="2px",t.appendChild(e),(e=mxUtils.button(mxResources.get("toBack"),function(t){n.actions.get("toBack").funct()})).setAttribute("title",mxResources.get("toBack")+" ("+this.editorUi.actions.get("toBack").shortcut+")"),e.style.width="100px",t.appendChild(e),t},ArrangePanel.prototype.addGroupOps=function(t){var e=this.editorUi,n=e.editor.graph,i=n.getSelectionCell(),l=this.format.getSelectionState(),s=0,o=null;if((t.style.paddingTop="8px",t.style.paddingBottom="6px",n.getSelectionCount()>1?((o=mxUtils.button(mxResources.get("group"),function(t){e.actions.get("group").funct()})).setAttribute("title",mxResources.get("group")+" ("+this.editorUi.actions.get("group").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",t.appendChild(o),s++):1==n.getSelectionCount()&&!n.getModel().isEdge(i)&&!n.isSwimlane(i)&&n.getModel().getChildCount(i)>0&&((o=mxUtils.button(mxResources.get("ungroup"),function(t){e.actions.get("ungroup").funct()})).setAttribute("title",mxResources.get("ungroup")+" ("+this.editorUi.actions.get("ungroup").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",t.appendChild(o),s++),l.vertices.length>0)&&(s>0&&(mxUtils.br(t),s=0),(o=mxUtils.button(mxResources.get("copySize"),function(t){e.actions.get("copySize").funct()})).setAttribute("title",mxResources.get("copySize")+" ("+this.editorUi.actions.get("copySize").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",t.appendChild(o),s++,null!=e.copiedSize)){var a=mxUtils.button(mxResources.get("pasteSize"),function(t){e.actions.get("pasteSize").funct()});a.setAttribute("title",mxResources.get("pasteSize")+" ("+this.editorUi.actions.get("pasteSize").shortcut+")"),t.appendChild(a),s++,o.style.width="100px",o.style.marginBottom="2px",a.style.width="100px",a.style.marginBottom="2px"}return 1==n.getSelectionCount()&&n.getModel().isVertex(i)&&n.getModel().isVertex(n.getModel().getParent(i))?(s>0&&mxUtils.br(t),(o=mxUtils.button(mxResources.get("removeFromGroup"),function(t){e.actions.get("removeFromGroup").funct()})).setAttribute("title",mxResources.get("removeFromGroup")),o.style.width="202px",o.style.marginBottom="2px",t.appendChild(o),s++):n.getSelectionCount()>0&&(s>0&&mxUtils.br(t),(o=mxUtils.button(mxResources.get("clearWaypoints"),mxUtils.bind(this,function(t){this.editorUi.actions.get("clearWaypoints").funct()}))).setAttribute("title",mxResources.get("clearWaypoints")+" ("+this.editorUi.actions.get("clearWaypoints").shortcut+")"),o.style.width="202px",o.style.marginBottom="2px",t.appendChild(o),s++),1==n.getSelectionCount()&&(s>0&&mxUtils.br(t),(o=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editData").funct()}))).setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),o.style.width="100px",o.style.marginBottom="2px",t.appendChild(o),s++,(o=mxUtils.button(mxResources.get("editLink"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editLink").funct()}))).setAttribute("title",mxResources.get("editLink")),o.style.width="100px",o.style.marginLeft="2px",o.style.marginBottom="2px",t.appendChild(o),s++),0==s&&(t.style.display="none"),t},ArrangePanel.prototype.addAlign=function(t){var e=this.editorUi.editor.graph;t.style.paddingTop="6px",t.style.paddingBottom="12px",t.appendChild(this.createTitle(mxResources.get("align")));var n=document.createElement("div");n.style.position="relative",n.style.paddingLeft="0px",n.style.borderWidth="0px",n.className="geToolbarContainer",mxClient.IS_QUIRKS&&(t.style.height="60px");var i=this.editorUi.toolbar.addButton("geSprite-alignleft",mxResources.get("left"),function(){e.alignCells(mxConstants.ALIGN_LEFT)},n),l=this.editorUi.toolbar.addButton("geSprite-aligncenter",mxResources.get("center"),function(){e.alignCells(mxConstants.ALIGN_CENTER)},n),s=this.editorUi.toolbar.addButton("geSprite-alignright",mxResources.get("right"),function(){e.alignCells(mxConstants.ALIGN_RIGHT)},n),o=this.editorUi.toolbar.addButton("geSprite-aligntop",mxResources.get("top"),function(){e.alignCells(mxConstants.ALIGN_TOP)},n),a=this.editorUi.toolbar.addButton("geSprite-alignmiddle",mxResources.get("middle"),function(){e.alignCells(mxConstants.ALIGN_MIDDLE)},n),r=this.editorUi.toolbar.addButton("geSprite-alignbottom",mxResources.get("bottom"),function(){e.alignCells(mxConstants.ALIGN_BOTTOM)},n);return this.styleButtons([i,l,s,o,a,r]),s.style.marginRight="6px",t.appendChild(n),t},ArrangePanel.prototype.addFlip=function(t){var e=this.editorUi.editor.graph;t.style.paddingTop="6px",t.style.paddingBottom="10px";var n,i=document.createElement("div");return i.style.marginTop="2px",i.style.marginBottom="8px",i.style.fontWeight="bold",mxUtils.write(i,mxResources.get("flip")),t.appendChild(i),(n=mxUtils.button(mxResources.get("horizontal"),function(t){e.toggleCellStyles(mxConstants.STYLE_FLIPH,!1)})).setAttribute("title",mxResources.get("horizontal")),n.style.width="100px",n.style.marginRight="2px",t.appendChild(n),(n=mxUtils.button(mxResources.get("vertical"),function(t){e.toggleCellStyles(mxConstants.STYLE_FLIPV,!1)})).setAttribute("title",mxResources.get("vertical")),n.style.width="100px",t.appendChild(n),t},ArrangePanel.prototype.addDistribute=function(t){var e,n=this.editorUi.editor.graph;return t.style.paddingTop="6px",t.style.paddingBottom="12px",t.appendChild(this.createTitle(mxResources.get("distribute"))),(e=mxUtils.button(mxResources.get("horizontal"),function(t){n.distributeCells(!0)})).setAttribute("title",mxResources.get("horizontal")),e.style.width="100px",e.style.marginRight="2px",t.appendChild(e),(e=mxUtils.button(mxResources.get("vertical"),function(t){n.distributeCells(!1)})).setAttribute("title",mxResources.get("vertical")),e.style.width="100px",t.appendChild(e),t},ArrangePanel.prototype.addAngle=function(t){var e=this.editorUi,n=e.editor.graph,i=this.format.getSelectionState();t.style.paddingBottom="8px";var l=document.createElement("div");l.style.position="absolute",l.style.width="70px",l.style.marginTop="0px",l.style.fontWeight="bold";var s=null,o=null,a=null;if(0==i.edges.length?(mxUtils.write(l,mxResources.get("angle")),t.appendChild(l),s=this.addUnitInput(t,"°",20,44,function(){o.apply(this,arguments)}),mxUtils.br(t),t.style.paddingTop="10px"):t.style.paddingTop="8px",!i.containsLabel){var r=mxResources.get("reverse");i.vertices.length>0&&i.edges.length>0?r=mxResources.get("turn")+" / "+r:i.vertices.length>0&&(r=mxResources.get("turn")),(a=mxUtils.button(r,function(t){e.actions.get("turn").funct()})).setAttribute("title",r+" ("+this.editorUi.actions.get("turn").shortcut+")"),a.style.width="202px",t.appendChild(a),null!=s&&(a.style.marginTop="8px")}if(null!=s){var d=mxUtils.bind(this,function(t,e,n){if(n||document.activeElement!=s){i=this.format.getSelectionState();var l=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION,0));s.value=isNaN(l)?"":l+"°"}});o=this.installInputHandler(s,mxConstants.STYLE_ROTATION,0,0,360,"°",null,!0),this.addKeyHandler(s,d),n.getModel().addListener(mxEvent.CHANGE,d),this.listeners.push({destroy:function(){n.getModel().removeListener(d)}}),d()}return t},BaseFormatPanel.prototype.getUnit=function(){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return"pt";case mxConstants.INCHES:return'"';case mxConstants.MILLIMETERS:return"mm"}},BaseFormatPanel.prototype.inUnit=function(t){return this.editorUi.editor.graph.view.formatUnitText(t)},BaseFormatPanel.prototype.fromUnit=function(t){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return t;case mxConstants.INCHES:return t*mxConstants.PIXELS_PER_INCH;case mxConstants.MILLIMETERS:return t*mxConstants.PIXELS_PER_MM}},BaseFormatPanel.prototype.isFloatUnit=function(){return this.editorUi.editor.graph.view.unit!=mxConstants.POINTS},BaseFormatPanel.prototype.getUnitStep=function(){switch(this.editorUi.editor.graph.view.unit){case mxConstants.POINTS:return 1;case mxConstants.INCHES:return.1;case mxConstants.MILLIMETERS:return.5}},ArrangePanel.prototype.addGeometry=function(t){var e,n,i,l,s=this,o=this.editorUi,a=o.editor.graph,r=this.format.getSelectionState(),d=this.createPanel();d.style.paddingBottom="8px",(x=document.createElement("div")).style.position="absolute",x.style.width="50px",x.style.marginTop="0px",x.style.fontWeight="bold",mxUtils.write(x,mxResources.get("size")),d.appendChild(x);var u=this.addUnitInput(d,this.getUnit(),84,44,function(){e.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),p=this.addUnitInput(d,this.getUnit(),20,44,function(){n.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),m=document.createElement("div");m.className="geSprite geSprite-fit",m.setAttribute("title",mxResources.get("autosize")+" ("+this.editorUi.actions.get("autosize").shortcut+")"),m.style.position="relative",m.style.cursor="pointer",m.style.marginTop="-3px",m.style.border="0px",m.style.left="52px",mxUtils.setOpacity(m,50),mxEvent.addListener(m,"mouseenter",function(){mxUtils.setOpacity(m,100)}),mxEvent.addListener(m,"mouseleave",function(){mxUtils.setOpacity(m,50)}),mxEvent.addListener(m,"click",function(){o.actions.get("autosize").funct()}),d.appendChild(m),this.addLabel(d,mxResources.get("width"),84),this.addLabel(d,mxResources.get("height"),20),mxUtils.br(d);var c=document.createElement("div");c.style.paddingTop="8px",c.style.paddingRight="20px",c.style.whiteSpace="nowrap",c.style.textAlign="right";var g=this.createCellOption(mxResources.get("constrainProportions"),mxConstants.STYLE_ASPECT,null,"fixed","null");g.style.width="100%",c.appendChild(g),d.appendChild(c);var h=g.getElementsByTagName("input")[0];this.addKeyHandler(u,E),this.addKeyHandler(p,E),e=this.addGeometryHandler(u,function(t,e){if(t.width>0){e=Math.max(1,s.fromUnit(e));h.checked&&(t.height=Math.round(t.height*e*100/t.width)/100),t.width=e}}),n=this.addGeometryHandler(p,function(t,e){if(t.height>0){e=Math.max(1,s.fromUnit(e));h.checked&&(t.width=Math.round(t.width*e*100/t.height)/100),t.height=e}}),t.appendChild(d);var x,y=this.createPanel();y.style.paddingBottom="30px",(x=document.createElement("div")).style.position="absolute",x.style.width="70px",x.style.marginTop="0px",x.style.fontWeight="bold",mxUtils.write(x,mxResources.get("position")),y.appendChild(x);var C=this.addUnitInput(y,this.getUnit(),84,44,function(){i.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit()),f=this.addUnitInput(y,this.getUnit(),20,44,function(){l.apply(this,arguments)},this.getUnitStep(),null,null,this.isFloatUnit());mxUtils.br(y),this.addLabel(y,mxResources.get("left"),84),this.addLabel(y,mxResources.get("top"),20);var E=mxUtils.bind(this,function(t,e,n){(r=this.format.getSelectionState()).containsLabel||r.vertices.length!=a.getSelectionCount()||null==r.width||null==r.height?d.style.display="none":(d.style.display="",(n||document.activeElement!=u)&&(u.value=this.inUnit(r.width)+(""==r.width?"":" "+this.getUnit())),(n||document.activeElement!=p)&&(p.value=this.inUnit(r.height)+(""==r.height?"":" "+this.getUnit()))),r.vertices.length==a.getSelectionCount()&&null!=r.x&&null!=r.y?(y.style.display="",(n||document.activeElement!=C)&&(C.value=this.inUnit(r.x)+(""==r.x?"":" "+this.getUnit())),(n||document.activeElement!=f)&&(f.value=this.inUnit(r.y)+(""==r.y?"":" "+this.getUnit()))):y.style.display="none"});this.addKeyHandler(C,E),this.addKeyHandler(f,E),a.getModel().addListener(mxEvent.CHANGE,E),this.listeners.push({destroy:function(){a.getModel().removeListener(E)}}),E(),i=this.addGeometryHandler(C,function(t,e){e=s.fromUnit(e),t.relative?t.offset.x=e:t.x=e}),l=this.addGeometryHandler(f,function(t,e){e=s.fromUnit(e),t.relative?t.offset.y=e:t.y=e}),t.appendChild(y)},ArrangePanel.prototype.addGeometryHandler=function(t,e){var n=this.editorUi.editor.graph,i=null,l=this;function s(s){if(""!=t.value){var o=parseFloat(t.value);if(isNaN(o))t.value=i+" "+l.getUnit();else if(o!=i){n.getModel().beginUpdate();try{for(var a=n.getSelectionCells(),r=0;r<a.length;r++)if(n.getModel().isVertex(a[r])){var d=n.getCellGeometry(a[r]);null!=d&&(d=d.clone(),e(d,o),n.getModel().setGeometry(a[r],d))}}finally{n.getModel().endUpdate()}i=o,t.value=o+" "+l.getUnit()}}mxEvent.consume(s)}return mxEvent.addListener(t,"blur",s),mxEvent.addListener(t,"change",s),mxEvent.addListener(t,"focus",function(){i=t.value}),s},ArrangePanel.prototype.addEdgeGeometryHandler=function(t,e){var n=this.editorUi.editor.graph,i=null;function l(l){if(""!=t.value){var s=parseFloat(t.value);if(isNaN(s))t.value=i+" pt";else if(s!=i){n.getModel().beginUpdate();try{for(var o=n.getSelectionCells(),a=0;a<o.length;a++)if(n.getModel().isEdge(o[a])){var r=n.getCellGeometry(o[a]);null!=r&&(r=r.clone(),e(r,s),n.getModel().setGeometry(o[a],r))}}finally{n.getModel().endUpdate()}i=s,t.value=s+" pt"}}mxEvent.consume(l)}return mxEvent.addListener(t,"blur",l),mxEvent.addListener(t,"change",l),mxEvent.addListener(t,"focus",function(){i=t.value}),l},ArrangePanel.prototype.addEdgeGeometry=function(t){var e,n,i,l,s,o=this.editorUi,a=o.editor.graph,r=this.format.getSelectionState(),d=this.createPanel();(g=document.createElement("div")).style.position="absolute",g.style.width="70px",g.style.marginTop="0px",g.style.fontWeight="bold",mxUtils.write(g,mxResources.get("width")),d.appendChild(g);var u=this.addUnitInput(d,"pt",20,44,function(){e.apply(this,arguments)});function e(t){var e=parseInt(u.value);(e=Math.min(999,Math.max(1,isNaN(e)?1:e)))!=mxUtils.getValue(r.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth)&&(a.setCellStyles("width",e,a.getSelectionCells()),o.fireEvent(new mxEventObject("styleChanged","keys",["width"],"values",[e],"cells",a.getSelectionCells()))),u.value=e+" pt",mxEvent.consume(t)}mxUtils.br(d),this.addKeyHandler(u,C),mxEvent.addListener(u,"blur",e),mxEvent.addListener(u,"change",e),t.appendChild(d);var p=this.createPanel();p.style.paddingBottom="30px",(g=document.createElement("div")).style.position="absolute",g.style.width="70px",g.style.marginTop="0px",g.style.fontWeight="bold",mxUtils.write(g,"Start"),p.appendChild(g);var m=this.addUnitInput(p,"pt",84,44,function(){l.apply(this,arguments)}),c=this.addUnitInput(p,"pt",20,44,function(){s.apply(this,arguments)});mxUtils.br(p),this.addLabel(p,mxResources.get("left"),84),this.addLabel(p,mxResources.get("top"),20),t.appendChild(p),this.addKeyHandler(m,C),this.addKeyHandler(c,C);var g,h=this.createPanel();h.style.paddingBottom="30px",(g=document.createElement("div")).style.position="absolute",g.style.width="70px",g.style.marginTop="0px",g.style.fontWeight="bold",mxUtils.write(g,"End"),h.appendChild(g);var x=this.addUnitInput(h,"pt",84,44,function(){n.apply(this,arguments)}),y=this.addUnitInput(h,"pt",20,44,function(){i.apply(this,arguments)});mxUtils.br(h),this.addLabel(h,mxResources.get("left"),84),this.addLabel(h,mxResources.get("top"),20),t.appendChild(h),this.addKeyHandler(x,C),this.addKeyHandler(y,C);var C=mxUtils.bind(this,function(t,e,n){r=this.format.getSelectionState();var i=a.getSelectionCell();if("link"==r.style.shape||"flexArrow"==r.style.shape){if(d.style.display="",n||document.activeElement!=u){var l=mxUtils.getValue(r.style,"width",mxCellRenderer.defaultShapes.flexArrow.prototype.defaultWidth);u.value=l+" pt"}}else d.style.display="none";if(1==a.getSelectionCount()&&a.model.isEdge(i)){var s=a.model.getGeometry(i);null!=s.sourcePoint&&null==a.model.getTerminal(i,!0)?(m.value=s.sourcePoint.x,c.value=s.sourcePoint.y):p.style.display="none",null!=s.targetPoint&&null==a.model.getTerminal(i,!1)?(x.value=s.targetPoint.x,y.value=s.targetPoint.y):h.style.display="none"}else p.style.display="none",h.style.display="none"});l=this.addEdgeGeometryHandler(m,function(t,e){t.sourcePoint.x=e}),s=this.addEdgeGeometryHandler(c,function(t,e){t.sourcePoint.y=e}),n=this.addEdgeGeometryHandler(x,function(t,e){t.targetPoint.x=e}),i=this.addEdgeGeometryHandler(y,function(t,e){t.targetPoint.y=e}),a.getModel().addListener(mxEvent.CHANGE,C),this.listeners.push({destroy:function(){a.getModel().removeListener(C)}}),C()},TextFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(TextFormatPanel,BaseFormatPanel),TextFormatPanel.prototype.init=function(){this.container.style.borderBottom="none",this.addFont(this.container)},TextFormatPanel.prototype.addFont=function(t){var e=this.editorUi,n=e.editor.graph,i=this.format.getSelectionState(),l=this.createTitle(mxResources.get("font"));l.style.paddingLeft="18px",l.style.paddingTop="10px",l.style.paddingBottom="6px",t.appendChild(l);var s=this.createPanel();if(s.style.paddingTop="2px",s.style.paddingBottom="2px",s.style.position="relative",s.style.marginLeft="-2px",s.style.borderWidth="0px",s.className="geToolbarContainer",mxClient.IS_QUIRKS&&(s.style.display="block"),n.cellEditor.isContentEditing()){var o=s.cloneNode(),a=this.editorUi.toolbar.addMenu(mxResources.get("style"),mxResources.get("style"),!0,"formatBlock",o,null,!0);a.style.color="rgb(112, 112, 112)",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.margin="0px",this.addArrow(a),a.style.width="192px",a.style.height="15px",a.getElementsByTagName("div")[0].style.cssFloat="right",t.appendChild(o)}t.appendChild(s);var r=this.createPanel();r.style.marginTop="8px",r.style.borderTop="1px solid #c0c0c0",r.style.paddingTop="6px",r.style.paddingBottom="6px";var d=this.editorUi.toolbar.addMenu("Helvetica",mxResources.get("fontFamily"),!0,"fontFamily",s,null,!0);d.style.color="rgb(112, 112, 112)",d.style.whiteSpace="nowrap",d.style.overflow="hidden",d.style.margin="0px",this.addArrow(d),d.style.width="192px",d.style.height="15px";var u=s.cloneNode(!1);u.style.marginLeft="-3px";var p=this.editorUi.toolbar.addItems(["bold","italic","underline"],u,!0);p[0].setAttribute("title",mxResources.get("bold")+" ("+this.editorUi.actions.get("bold").shortcut+")"),p[1].setAttribute("title",mxResources.get("italic")+" ("+this.editorUi.actions.get("italic").shortcut+")"),p[2].setAttribute("title",mxResources.get("underline")+" ("+this.editorUi.actions.get("underline").shortcut+")");var m=this.editorUi.toolbar.addItems(["vertical"],u,!0)[0];mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(u),this.styleButtons(p),this.styleButtons([m]);var c=s.cloneNode(!1);c.style.marginLeft="-3px",c.style.paddingBottom="0px";var g=function(t){return function(){return t()}},h=this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),n.cellEditor.isContentEditing()?function(t){n.cellEditor.alignText(mxConstants.ALIGN_LEFT,t)}:g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_LEFT])),c),x=this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),n.cellEditor.isContentEditing()?function(t){n.cellEditor.alignText(mxConstants.ALIGN_CENTER,t)}:g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_CENTER])),c),y=this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),n.cellEditor.isContentEditing()?function(t){n.cellEditor.alignText(mxConstants.ALIGN_RIGHT,t)}:g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_ALIGN],[mxConstants.ALIGN_RIGHT])),c);if(this.styleButtons([h,x,y]),n.cellEditor.isContentEditing()){var C=this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("strikethrough"),function(){document.execCommand("strikeThrough",!1,null)},u);this.styleButtons([C]),C.firstChild.style.background="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0wIDBoMjR2MjRIMFYweiIvPjwvZGVmcz48Y2xpcFBhdGggaWQ9ImIiPjx1c2UgeGxpbms6aHJlZj0iI2EiIG92ZXJmbG93PSJ2aXNpYmxlIi8+PC9jbGlwUGF0aD48cGF0aCBjbGlwLXBhdGg9InVybCgjYikiIGZpbGw9IiMwMTAxMDEiIGQ9Ik03LjI0IDguNzVjLS4yNi0uNDgtLjM5LTEuMDMtLjM5LTEuNjcgMC0uNjEuMTMtMS4xNi40LTEuNjcuMjYtLjUuNjMtLjkzIDEuMTEtMS4yOS40OC0uMzUgMS4wNS0uNjMgMS43LS44My42Ni0uMTkgMS4zOS0uMjkgMi4xOC0uMjkuODEgMCAxLjU0LjExIDIuMjEuMzQuNjYuMjIgMS4yMy41NCAxLjY5Ljk0LjQ3LjQuODMuODggMS4wOCAxLjQzLjI1LjU1LjM4IDEuMTUuMzggMS44MWgtMy4wMWMwLS4zMS0uMDUtLjU5LS4xNS0uODUtLjA5LS4yNy0uMjQtLjQ5LS40NC0uNjgtLjItLjE5LS40NS0uMzMtLjc1LS40NC0uMy0uMS0uNjYtLjE2LTEuMDYtLjE2LS4zOSAwLS43NC4wNC0xLjAzLjEzLS4yOS4wOS0uNTMuMjEtLjcyLjM2LS4xOS4xNi0uMzQuMzQtLjQ0LjU1LS4xLjIxLS4xNS40My0uMTUuNjYgMCAuNDguMjUuODguNzQgMS4yMS4zOC4yNS43Ny40OCAxLjQxLjdINy4zOWMtLjA1LS4wOC0uMTEtLjE3LS4xNS0uMjV6TTIxIDEydi0ySDN2Mmg5LjYyYy4xOC4wNy40LjE0LjU1LjIuMzcuMTcuNjYuMzQuODcuNTEuMjEuMTcuMzUuMzYuNDMuNTcuMDcuMi4xMS40My4xMS42OSAwIC4yMy0uMDUuNDUtLjE0LjY2LS4wOS4yLS4yMy4zOC0uNDIuNTMtLjE5LjE1LS40Mi4yNi0uNzEuMzUtLjI5LjA4LS42My4xMy0xLjAxLjEzLS40MyAwLS44My0uMDQtMS4xOC0uMTNzLS42Ni0uMjMtLjkxLS40MmMtLjI1LS4xOS0uNDUtLjQ0LS41OS0uNzUtLjE0LS4zMS0uMjUtLjc2LS4yNS0xLjIxSDYuNGMwIC41NS4wOCAxLjEzLjI0IDEuNTguMTYuNDUuMzcuODUuNjUgMS4yMS4yOC4zNS42LjY2Ljk4LjkyLjM3LjI2Ljc4LjQ4IDEuMjIuNjUuNDQuMTcuOS4zIDEuMzguMzkuNDguMDguOTYuMTMgMS40NC4xMy44IDAgMS41My0uMDkgMi4xOC0uMjhzMS4yMS0uNDUgMS42Ny0uNzljLjQ2LS4zNC44Mi0uNzcgMS4wNy0xLjI3cy4zOC0xLjA3LjM4LTEuNzFjMC0uNi0uMS0xLjE0LS4zMS0xLjYxLS4wNS0uMTEtLjExLS4yMy0uMTctLjMzSDIxeiIvPjwvc3ZnPg==)",C.firstChild.style.backgroundPosition="2px 2px",C.firstChild.style.backgroundSize="18px 18px",this.styleButtons([C])}var f,E,S,v,L,b,T,U=this.editorUi.toolbar.addButton("geSprite-top",mxResources.get("top"),g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_TOP])),c),I=this.editorUi.toolbar.addButton("geSprite-middle",mxResources.get("middle"),g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_MIDDLE])),c),N=this.editorUi.toolbar.addButton("geSprite-bottom",mxResources.get("bottom"),g(this.editorUi.menus.createStyleChangeFunction([mxConstants.STYLE_VERTICAL_ALIGN],[mxConstants.ALIGN_BOTTOM])),c);if(this.styleButtons([U,I,N]),mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(c),n.cellEditor.isContentEditing()){U.style.display="none",I.style.display="none",N.style.display="none",m.style.display="none",(S=this.editorUi.toolbar.addButton("geSprite-justifyfull",mxResources.get("block"),function(){1==S.style.opacity&&document.execCommand("justifyfull",!1,null)},c)).style.marginRight="9px",S.style.opacity=1,this.styleButtons([S,f=this.editorUi.toolbar.addButton("geSprite-subscript",mxResources.get("subscript")+" ("+Editor.ctrlKey+"+,)",function(){document.execCommand("subscript",!1,null)},c),E=this.editorUi.toolbar.addButton("geSprite-superscript",mxResources.get("superscript")+" ("+Editor.ctrlKey+"+.)",function(){document.execCommand("superscript",!1,null)},c)]),f.style.marginLeft="9px";var R=c.cloneNode(!1);R.style.paddingTop="4px";var A=[this.editorUi.toolbar.addButton("geSprite-orderedlist",mxResources.get("numberedList"),function(){document.execCommand("insertorderedlist",!1,null)},R),this.editorUi.toolbar.addButton("geSprite-unorderedlist",mxResources.get("bulletedList"),function(){document.execCommand("insertunorderedlist",!1,null)},R),this.editorUi.toolbar.addButton("geSprite-outdent",mxResources.get("decreaseIndent"),function(){document.execCommand("outdent",!1,null)},R),this.editorUi.toolbar.addButton("geSprite-indent",mxResources.get("increaseIndent"),function(){document.execCommand("indent",!1,null)},R),this.editorUi.toolbar.addButton("geSprite-removeformat",mxResources.get("removeFormat"),function(){document.execCommand("removeformat",!1,null)},R),this.editorUi.toolbar.addButton("geSprite-code",mxResources.get("html"),function(){n.cellEditor.toggleViewMode()},R)];this.styleButtons(A),A[A.length-2].style.marginLeft="9px",mxClient.IS_QUIRKS&&(mxUtils.br(t),R.style.height="40"),t.appendChild(R)}else p[2].style.marginRight="9px",y.style.marginRight="9px";var w=s.cloneNode(!1);w.style.marginLeft="0px",w.style.paddingTop="8px",w.style.paddingBottom="4px",w.style.fontWeight="normal",mxUtils.write(w,mxResources.get("position"));var _=document.createElement("select");_.style.position="absolute",_.style.right="20px",_.style.width="97px",_.style.marginTop="-2px";for(var M=["topLeft","top","topRight","left","center","right","bottomLeft","bottom","bottomRight"],O={topLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM],top:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM],topRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM],left:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE],center:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_MIDDLE],right:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_MIDDLE,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_MIDDLE],bottomLeft:[mxConstants.ALIGN_LEFT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_TOP],bottom:[mxConstants.ALIGN_CENTER,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_CENTER,mxConstants.ALIGN_TOP],bottomRight:[mxConstants.ALIGN_RIGHT,mxConstants.ALIGN_BOTTOM,mxConstants.ALIGN_LEFT,mxConstants.ALIGN_TOP]},P=0;P<M.length;P++){var B=document.createElement("option");B.setAttribute("value",M[P]),mxUtils.write(B,mxResources.get(M[P])),_.appendChild(B)}w.appendChild(_);var G=s.cloneNode(!1);G.style.marginLeft="0px",G.style.paddingTop="4px",G.style.paddingBottom="4px",G.style.fontWeight="normal",mxUtils.write(G,mxResources.get("writingDirection"));var F=document.createElement("select");F.style.position="absolute",F.style.right="20px",F.style.width="97px",F.style.marginTop="-2px";var D=["automatic","leftToRight","rightToLeft"],k={automatic:null,leftToRight:mxConstants.TEXT_DIRECTION_LTR,rightToLeft:mxConstants.TEXT_DIRECTION_RTL};for(P=0;P<D.length;P++){var H=document.createElement("option");H.setAttribute("value",D[P]),mxUtils.write(H,mxResources.get(D[P])),F.appendChild(H)}G.appendChild(F),n.isEditing()||(t.appendChild(w),mxEvent.addListener(_,"change",function(t){n.getModel().beginUpdate();try{var e=O[_.value];null!=e&&(n.setCellStyles(mxConstants.STYLE_LABEL_POSITION,e[0],n.getSelectionCells()),n.setCellStyles(mxConstants.STYLE_VERTICAL_LABEL_POSITION,e[1],n.getSelectionCells()),n.setCellStyles(mxConstants.STYLE_ALIGN,e[2],n.getSelectionCells()),n.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,e[3],n.getSelectionCells()))}finally{n.getModel().endUpdate()}mxEvent.consume(t)}),t.appendChild(G),mxEvent.addListener(F,"change",function(t){n.setCellStyles(mxConstants.STYLE_TEXT_DIRECTION,k[F.value],n.getSelectionCells()),mxEvent.consume(t)}));var Y=document.createElement("input");Y.style.textAlign="right",Y.style.marginTop="4px",mxClient.IS_QUIRKS||(Y.style.position="absolute",Y.style.right="32px"),Y.style.width="46px",Y.style.height=mxClient.IS_QUIRKS?"21px":"17px",u.appendChild(Y);var j=null,z=this.installInputHandler(Y,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize,1,999," pt",function(t){if(!window.getSelection||mxClient.IS_IE||mxClient.IS_IE11){if(window.getSelection||document.selection){var e=null;if(document.selection)e=document.selection.createRange().parentElement();else(i=window.getSelection()).rangeCount>0&&(e=i.getRangeAt(0).commonAncestorContainer);if(null!=e&&function(t,e){for(;null!=e;){if(e===t)return!0;e=e.parentNode}return!1}(n.cellEditor.textarea,e)){j=t,document.execCommand("fontSize",!1,"4");for(o=n.cellEditor.textarea.getElementsByTagName("font"),a=0;a<o.length;a++)if("4"==o[a].getAttribute("size")){o[a].removeAttribute("size"),o[a].style.fontSize=j+"px",window.setTimeout(function(){Y.value=j+" pt",j=null},0);break}}}}else{var i,l=(i=window.getSelection()).rangeCount>0?i.getRangeAt(0).commonAncestorContainer:n.cellEditor.textarea;function s(e,l){null!=n.cellEditor.textarea&&e!=n.cellEditor.textarea&&n.cellEditor.textarea.contains(e)&&(l||i.containsNode(e,!0))&&("FONT"==e.nodeName?(e.removeAttribute("size"),e.style.fontSize=t+"px"):mxUtils.getCurrentStyle(e).fontSize!=t+"px"&&(mxUtils.getCurrentStyle(e.parentNode).fontSize!=t+"px"?e.style.fontSize=t+"px":e.style.fontSize=""))}if(l!=n.cellEditor.textarea&&l.nodeType==mxConstants.NODETYPE_ELEMENT||document.execCommand("fontSize",!1,"1"),l!=n.cellEditor.textarea&&(l=l.parentNode),null!=l&&l.nodeType==mxConstants.NODETYPE_ELEMENT){var o=l.getElementsByTagName("*");s(l);for(var a=0;a<o.length;a++)s(o[a])}Y.value=t+" pt"}},!0),V=this.createStepper(Y,z,1,10,!0,Menus.prototype.defaultFontSize);V.style.display=Y.style.display,V.style.marginTop="4px",mxClient.IS_QUIRKS||(V.style.right="20px"),u.appendChild(V),d.getElementsByTagName("div")[0].style.cssFloat="right";var K=null,W="#ffffff",Q=null,Z="#000000",X=n.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("backgroundColor"),function(){return W},function(t){document.execCommand("backcolor",!1,t!=mxConstants.NONE?t:"transparent")},"#ffffff",{install:function(t){K=t},destroy:function(){K=null}},null,!0):this.createCellColorOption(mxResources.get("backgroundColor"),mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#ffffff",null,function(t){n.updateLabelElements(n.getSelectionCells(),function(t){t.style.backgroundColor=null})});X.style.fontWeight="bold";var J=this.createCellColorOption(mxResources.get("borderColor"),mxConstants.STYLE_LABEL_BORDERCOLOR,"#000000");J.style.fontWeight="bold";var q=n.cellEditor.isContentEditing()?this.createColorOption(mxResources.get("fontColor"),function(){return Z},function(t){if(mxClient.IS_FF){for(var e=n.cellEditor.textarea.getElementsByTagName("font"),i=[],l=0;l<e.length;l++)i.push({node:e[l],color:e[l].getAttribute("color")});document.execCommand("forecolor",!1,t!=mxConstants.NONE?t:"transparent");var s=n.cellEditor.textarea.getElementsByTagName("font");for(l=0;l<s.length;l++)if(l>=i.length||s[l]!=i[l].node||s[l]==i[l].node&&s[l].getAttribute("color")!=i[l].color){var o=s[l].firstChild;if(null!=o&&"A"==o.nodeName&&null==o.nextSibling&&null!=o.firstChild){s[l].parentNode.insertBefore(o,s[l]);for(e=o.firstChild;null!=e;){var a=e.nextSibling;s[l].appendChild(e),e=a}o.appendChild(s[l])}break}}else document.execCommand("forecolor",!1,t!=mxConstants.NONE?t:"transparent")},"#000000",{install:function(t){Q=t},destroy:function(){Q=null}},null,!0):this.createCellColorOption(mxResources.get("fontColor"),mxConstants.STYLE_FONTCOLOR,"#000000",function(t){null==t||t==mxConstants.NONE?X.style.display="none":X.style.display="",J.style.display=X.style.display},function(t){null==t||t==mxConstants.NONE?n.setCellStyles(mxConstants.STYLE_NOLABEL,"1",n.getSelectionCells()):n.setCellStyles(mxConstants.STYLE_NOLABEL,null,n.getSelectionCells()),n.updateLabelElements(n.getSelectionCells(),function(t){t.removeAttribute("color"),t.style.color=null})});q.style.fontWeight="bold",r.appendChild(q),r.appendChild(X),n.cellEditor.isContentEditing()||r.appendChild(J),t.appendChild(r);var $=this.createPanel();$.style.paddingTop="2px",$.style.paddingBottom="4px";var tt=this.createCellOption(mxResources.get("wordWrap"),mxConstants.STYLE_WHITE_SPACE,null,"wrap","null",null,null,!0);tt.style.fontWeight="bold",i.containsLabel||i.autoSize||0!=i.edges.length||$.appendChild(tt);var et=this.createCellOption(mxResources.get("formattedText"),"html","0",null,null,null,e.actions.get("formattedText"));et.style.fontWeight="bold",$.appendChild(et);var nt=this.createPanel();nt.style.paddingTop="10px",nt.style.paddingBottom="28px",nt.style.fontWeight="normal";var it,lt,st,ot,at,rt=document.createElement("div");rt.style.position="absolute",rt.style.width="70px",rt.style.marginTop="0px",rt.style.fontWeight="bold",mxUtils.write(rt,mxResources.get("spacing")),nt.appendChild(rt);var dt=this.addUnitInput(nt,"pt",91,44,function(){it.apply(this,arguments)}),ut=this.addUnitInput(nt,"pt",20,44,function(){lt.apply(this,arguments)});mxUtils.br(nt),this.addLabel(nt,mxResources.get("top"),91),this.addLabel(nt,mxResources.get("global"),20),mxUtils.br(nt),mxUtils.br(nt);var pt=this.addUnitInput(nt,"pt",162,44,function(){st.apply(this,arguments)}),mt=this.addUnitInput(nt,"pt",91,44,function(){ot.apply(this,arguments)}),ct=this.addUnitInput(nt,"pt",20,44,function(){at.apply(this,arguments)});if(mxUtils.br(nt),this.addLabel(nt,mxResources.get("left"),162),this.addLabel(nt,mxResources.get("bottom"),91),this.addLabel(nt,mxResources.get("right"),20),n.cellEditor.isContentEditing()){var gt=null,ht=null;t.appendChild(this.createRelativeOption(mxResources.get("lineheight"),null,null,function(t){var e=""==t.value?120:parseInt(t.value);e=Math.max(0,isNaN(e)?120:e),null!=gt&&(n.cellEditor.restoreSelection(gt),gt=null);for(var i=n.getSelectedElement();null!=i&&i.nodeType!=mxConstants.NODETYPE_ELEMENT;)i=i.parentNode;null!=i&&i==n.cellEditor.textarea&&null!=n.cellEditor.textarea.firstChild&&("P"!=n.cellEditor.textarea.firstChild.nodeName&&(n.cellEditor.textarea.innerHTML="<p>"+n.cellEditor.textarea.innerHTML+"</p>"),i=n.cellEditor.textarea.firstChild),null!=i&&null!=n.cellEditor.textarea&&i!=n.cellEditor.textarea&&n.cellEditor.textarea.contains(i)&&(i.style.lineHeight=e+"%"),t.value=e+" %"},function(t){ht=t,mxEvent.addListener(t,"mousedown",function(){document.activeElement==n.cellEditor.textarea&&(gt=n.cellEditor.saveSelection())}),mxEvent.addListener(t,"touchstart",function(){document.activeElement==n.cellEditor.textarea&&(gt=n.cellEditor.saveSelection())}),t.value="120 %"}));var xt=this.createPanel();xt.style.paddingTop="10px",xt.style.paddingBottom="10px",xt.appendChild(this.createTitle(mxResources.get("insert"))),xt.appendChild(insertPanel),t.appendChild(xt),mxClient.IS_QUIRKS&&(xt.style.height="70");var yt=s.cloneNode(!1);yt.style.paddingLeft="0px";A=[this.editorUi.toolbar.addButton("geSprite-insertcolumnbefore",mxResources.get("insertColumnBefore"),mxUtils.bind(this,function(){try{null!=L&&n.insertColumn(L,null!=b?b.cellIndex:0)}catch(t){this.editorUi.handleError(t)}}),yt),this.editorUi.toolbar.addButton("geSprite-insertcolumnafter",mxResources.get("insertColumnAfter"),mxUtils.bind(this,function(){try{null!=L&&n.insertColumn(L,null!=b?b.cellIndex+1:-1)}catch(t){this.editorUi.handleError(t)}}),yt),this.editorUi.toolbar.addButton("geSprite-deletecolumn",mxResources.get("deleteColumn"),mxUtils.bind(this,function(){try{null!=L&&null!=b&&n.deleteColumn(L,b.cellIndex)}catch(t){this.editorUi.handleError(t)}}),yt),this.editorUi.toolbar.addButton("geSprite-insertrowbefore",mxResources.get("insertRowBefore"),mxUtils.bind(this,function(){try{null!=L&&null!=T&&n.insertRow(L,T.sectionRowIndex)}catch(t){this.editorUi.handleError(t)}}),yt),this.editorUi.toolbar.addButton("geSprite-insertrowafter",mxResources.get("insertRowAfter"),mxUtils.bind(this,function(){try{null!=L&&null!=T&&n.insertRow(L,T.sectionRowIndex+1)}catch(t){this.editorUi.handleError(t)}}),yt),this.editorUi.toolbar.addButton("geSprite-deleterow",mxResources.get("deleteRow"),mxUtils.bind(this,function(){try{null!=L&&null!=T&&n.deleteRow(L,T.sectionRowIndex)}catch(t){this.editorUi.handleError(t)}}),yt)];this.styleButtons(A),A[2].style.marginRight="9px";var Ct=this.createPanel();Ct.style.paddingTop="10px",Ct.style.paddingBottom="10px",Ct.appendChild(this.createTitle(mxResources.get("table"))),Ct.appendChild(yt),mxClient.IS_QUIRKS&&(mxUtils.br(t),Ct.style.height="70");var ft=s.cloneNode(!1);ft.style.paddingLeft="0px";A=[this.editorUi.toolbar.addButton("geSprite-strokecolor",mxResources.get("borderColor"),mxUtils.bind(this,function(t){if(null!=L){var e=L.style.borderColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)});this.editorUi.pickColor(e,function(e){var i=null==b||null!=t&&mxEvent.isShiftDown(t)?L:b;n.processElements(i,function(t){t.style.border=null}),null==e||e==mxConstants.NONE?(i.removeAttribute("border"),i.style.border="",i.style.borderCollapse=""):(i.setAttribute("border","1"),i.style.border="1px solid "+e,i.style.borderCollapse="collapse")})}}),ft),this.editorUi.toolbar.addButton("geSprite-fillcolor",mxResources.get("backgroundColor"),mxUtils.bind(this,function(t){if(null!=L){var e=L.style.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)});this.editorUi.pickColor(e,function(e){var i=null==b||null!=t&&mxEvent.isShiftDown(t)?L:b;n.processElements(i,function(t){t.style.backgroundColor=null}),null==e||e==mxConstants.NONE?i.style.backgroundColor="":i.style.backgroundColor=e})}}),ft),this.editorUi.toolbar.addButton("geSprite-fit",mxResources.get("spacing"),function(){if(null!=L){var t=L.getAttribute("cellPadding")||0,n=new FilenameDialog(e,t,mxResources.get("apply"),mxUtils.bind(this,function(t){null!=t&&t.length>0?L.setAttribute("cellPadding",t):L.removeAttribute("cellPadding")}),mxResources.get("spacing"));e.showDialog(n.container,300,80,!0,!0),n.init()}},ft),this.editorUi.toolbar.addButton("geSprite-left",mxResources.get("left"),function(){null!=L&&L.setAttribute("align","left")},ft),this.editorUi.toolbar.addButton("geSprite-center",mxResources.get("center"),function(){null!=L&&L.setAttribute("align","center")},ft),this.editorUi.toolbar.addButton("geSprite-right",mxResources.get("right"),function(){null!=L&&L.setAttribute("align","right")},ft)];this.styleButtons(A),A[2].style.marginRight="9px",mxClient.IS_QUIRKS&&(mxUtils.br(Ct),mxUtils.br(Ct)),Ct.appendChild(ft),t.appendChild(Ct),v=Ct}else t.appendChild($),t.appendChild(this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_TEXT_OPACITY)),t.appendChild(nt);function Et(t,e){mxClient.IS_IE&&(mxClient.IS_QUIRKS||document.documentMode<10)?t.style.filter=e?"progid:DXImageTransform.Microsoft.Gradient(StartColorStr='#c5ecff', EndColorStr='#87d4fb', GradientType=0)":"":t.style.backgroundImage=e?"linear-gradient(#c5ecff 0px,#87d4fb 100%)":""}var St=mxUtils.bind(this,function(t,e,n){i=this.format.getSelectionState();var l=mxUtils.getValue(i.style,mxConstants.STYLE_FONTSTYLE,0);if(Et(p[0],(l&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD),Et(p[1],(l&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC),Et(p[2],(l&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE),d.firstChild.nodeValue=mxUtils.getValue(i.style,mxConstants.STYLE_FONTFAMILY,Menus.prototype.defaultFont),Et(m,"0"==mxUtils.getValue(i.style,mxConstants.STYLE_HORIZONTAL,"1")),n||document.activeElement!=Y){var s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_FONTSIZE,Menus.prototype.defaultFontSize));Y.value=isNaN(s)?"":s+" pt"}var o=mxUtils.getValue(i.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER);Et(h,o==mxConstants.ALIGN_LEFT),Et(x,o==mxConstants.ALIGN_CENTER),Et(y,o==mxConstants.ALIGN_RIGHT);var a=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE);Et(U,a==mxConstants.ALIGN_TOP),Et(I,a==mxConstants.ALIGN_MIDDLE),Et(N,a==mxConstants.ALIGN_BOTTOM);var r=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),u=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);r==mxConstants.ALIGN_LEFT&&u==mxConstants.ALIGN_TOP?_.value="topLeft":r==mxConstants.ALIGN_CENTER&&u==mxConstants.ALIGN_TOP?_.value="top":r==mxConstants.ALIGN_RIGHT&&u==mxConstants.ALIGN_TOP?_.value="topRight":r==mxConstants.ALIGN_LEFT&&u==mxConstants.ALIGN_BOTTOM?_.value="bottomLeft":r==mxConstants.ALIGN_CENTER&&u==mxConstants.ALIGN_BOTTOM?_.value="bottom":r==mxConstants.ALIGN_RIGHT&&u==mxConstants.ALIGN_BOTTOM?_.value="bottomRight":r==mxConstants.ALIGN_LEFT?_.value="left":r==mxConstants.ALIGN_RIGHT?_.value="right":_.value="center";var c=mxUtils.getValue(i.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);if(c==mxConstants.TEXT_DIRECTION_RTL?F.value="rightToLeft":c==mxConstants.TEXT_DIRECTION_LTR?F.value="leftToRight":c==mxConstants.TEXT_DIRECTION_AUTO&&(F.value="automatic"),n||document.activeElement!=ut){s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_SPACING,2));ut.value=isNaN(s)?"":s+" pt"}if(n||document.activeElement!=dt){s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_SPACING_TOP,0));dt.value=isNaN(s)?"":s+" pt"}if(n||document.activeElement!=ct){s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_SPACING_RIGHT,0));ct.value=isNaN(s)?"":s+" pt"}if(n||document.activeElement!=mt){s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_SPACING_BOTTOM,0));mt.value=isNaN(s)?"":s+" pt"}if(n||document.activeElement!=pt){s=parseFloat(mxUtils.getValue(i.style,mxConstants.STYLE_SPACING_LEFT,0));pt.value=isNaN(s)?"":s+" pt"}});if(lt=this.installInputHandler(ut,mxConstants.STYLE_SPACING,2,-999,999," pt"),it=this.installInputHandler(dt,mxConstants.STYLE_SPACING_TOP,0,-999,999," pt"),at=this.installInputHandler(ct,mxConstants.STYLE_SPACING_RIGHT,0,-999,999," pt"),ot=this.installInputHandler(mt,mxConstants.STYLE_SPACING_BOTTOM,0,-999,999," pt"),st=this.installInputHandler(pt,mxConstants.STYLE_SPACING_LEFT,0,-999,999," pt"),this.addKeyHandler(Y,St),this.addKeyHandler(ut,St),this.addKeyHandler(dt,St),this.addKeyHandler(ct,St),this.addKeyHandler(mt,St),this.addKeyHandler(pt,St),n.getModel().addListener(mxEvent.CHANGE,St),this.listeners.push({destroy:function(){n.getModel().removeListener(St)}}),St(),n.cellEditor.isContentEditing()){var vt=!1,Lt=function(){vt||(vt=!0,window.setTimeout(function(){for(var t=n.getSelectedElement();null!=t&&t.nodeType!=mxConstants.NODETYPE_ELEMENT;)t=t.parentNode;if(null!=t){function e(t,e,n){if(null!=n.style&&null!=e){var i=e.lineHeight;return null!=n.style.lineHeight&&"%"==n.style.lineHeight.substring(n.style.lineHeight.length-1)?parseInt(n.style.lineHeight)/100:"px"==i.substring(i.length-2)?parseFloat(i)/t:parseInt(i)}return""}function l(t){var e=null!=t?t.fontSize:null;return null!=e&&"px"==e.substring(e.length-2)?parseFloat(e):mxConstants.DEFAULT_FONTSIZE}t==n.cellEditor.textarea&&1==n.cellEditor.textarea.children.length&&n.cellEditor.textarea.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT&&(t=n.cellEditor.textarea.firstChild);var s=mxUtils.getCurrentStyle(t),o=l(s),a=e(o,s,t),r=t.getElementsByTagName("*");if(r.length>0&&window.getSelection&&!mxClient.IS_IE&&!mxClient.IS_IE11)for(var u=window.getSelection(),m=0;m<r.length;m++){if(u.containsNode(r[m],!0))temp=mxUtils.getCurrentStyle(r[m]),((U=e(o=Math.max(l(temp),o),temp,r[m]))!=a||isNaN(U))&&(a="")}function c(e){if(null!=n.getParentByName(t,e,n.cellEditor.textarea))return!0;for(var i=t;null!=i&&1==i.childNodes.length;)if((i=i.childNodes[0]).nodeName==e)return!0;return!1}function g(t,e){if(null!=t&&null!=e){if(t==e)return!0;if(t.length>e.length+1)return t.substring(t.length-e.length-1,t.length)=="-"+e}return!1}if(null!=s){if(Et(p[0],"bold"==s.fontWeight||s.fontWeight>400||c("B")||c("STRONG")),Et(p[1],"italic"==s.fontStyle||c("I")||c("EM")),Et(p[2],c("U")),Et(E,c("SUP")),Et(f,c("SUB")),n.cellEditor.isTableSelected())Et(S,g(s.textAlign,"justify")),Et(h,g(s.textAlign,"left")),Et(x,g(s.textAlign,"center")),Et(y,g(s.textAlign,"right"));else{var C=n.cellEditor.align||mxUtils.getValue(i.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER);g(s.textAlign,"justify")?(Et(S,g(s.textAlign,"justify")),Et(h,!1),Et(x,!1),Et(y,!1)):(Et(S,!1),Et(h,C==mxConstants.ALIGN_LEFT),Et(x,C==mxConstants.ALIGN_CENTER),Et(y,C==mxConstants.ALIGN_RIGHT))}if(L=n.getParentByName(t,"TABLE",n.cellEditor.textarea),T=null==L?null:n.getParentByName(t,"TR",L),b=null==L?null:n.getParentByNames(t,["TD","TH"],L),v.style.display=null!=L?"":"none",document.activeElement!=Y){"FONT"==t.nodeName&&"4"==t.getAttribute("size")&&null!=j?(t.removeAttribute("size"),t.style.fontSize=j+" pt",j=null):Y.value=isNaN(o)?"":o+" pt";var U=parseFloat(a);isNaN(U)?ht.value="100 %":ht.value=Math.round(100*U)+" %"}var I=s.color.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)}),N=s.backgroundColor.replace(/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g,function(t,e,n,i){return"#"+("0"+Number(e).toString(16)).substr(-2)+("0"+Number(n).toString(16)).substr(-2)+("0"+Number(i).toString(16)).substr(-2)});if(null!=Q&&(Z="#"==I.charAt(0)?I:"#000000",Q(Z,!0)),null!=K&&(W="#"==N.charAt(0)?N:null,K(W,!0)),null!=d.firstChild){var R=s.fontFamily;"'"==R.charAt(0)&&(R=R.substring(1)),"'"==R.charAt(R.length-1)&&(R=R.substring(0,R.length-1)),'"'==R.charAt(0)&&(R=R.substring(1)),'"'==R.charAt(R.length-1)&&(R=R.substring(0,R.length-1)),d.firstChild.nodeValue=R}}}vt=!1},0))};(mxClient.IS_FF||mxClient.IS_EDGE||mxClient.IS_IE||mxClient.IS_IE11)&&mxEvent.addListener(n.cellEditor.textarea,"DOMSubtreeModified",Lt),mxEvent.addListener(n.cellEditor.textarea,"input",Lt),mxEvent.addListener(n.cellEditor.textarea,"touchend",Lt),mxEvent.addListener(n.cellEditor.textarea,"mouseup",Lt),mxEvent.addListener(n.cellEditor.textarea,"keyup",Lt),this.listeners.push({destroy:function(){}}),Lt()}return t},StyleFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(StyleFormatPanel,BaseFormatPanel),StyleFormatPanel.prototype.defaultStrokeColor="black",StyleFormatPanel.prototype.init=function(){this.editorUi.editor.graph;var t=this.format.getSelectionState();if(!t.containsLabel){t.containsImage&&1==t.vertices.length&&"image"==t.style.shape&&null!=t.style.image&&"data:image/svg+xml;"==t.style.image.substring(0,19)&&this.container.appendChild(this.addSvgStyles(this.createPanel())),t.containsImage&&"image"!=t.style.shape||this.container.appendChild(this.addFill(this.createPanel())),this.container.appendChild(this.addStroke(this.createPanel())),this.container.appendChild(this.addLineJumps(this.createPanel()));var e=this.createRelativeOption(mxResources.get("opacity"),mxConstants.STYLE_OPACITY,41);e.style.paddingTop="8px",e.style.paddingBottom="8px",this.container.appendChild(e),this.container.appendChild(this.addEffects(this.createPanel()))}var n=this.addEditOps(this.createPanel());null!=n.firstChild&&mxUtils.br(n),this.container.appendChild(this.addStyleOps(n))},StyleFormatPanel.prototype.getCssRules=function(t){var e=document.implementation.createHTMLDocument(""),n=document.createElement("style");return mxUtils.setTextContent(n,t),e.body.appendChild(n),n.sheet.cssRules},StyleFormatPanel.prototype.addSvgStyles=function(t){this.editorUi.editor.graph;var e=this.format.getSelectionState();t.style.paddingTop="6px",t.style.paddingBottom="6px",t.style.fontWeight="bold",t.style.display="none";try{var n=e.style.editableCssRules;if(null!=n){var i=new RegExp(n),l=e.style.image.substring(e.style.image.indexOf(",")+1),s=window.atob?atob(l):Base64.decode(l,!0),o=mxUtils.parseXml(s);if(null!=o)for(var a=o.getElementsByTagName("style"),r=0;r<a.length;r++)for(var d=this.getCssRules(mxUtils.getTextContent(a[r])),u=0;u<d.length;u++)this.addSvgRule(t,d[u],o,a[r],d,u,i)}}catch(t){}return t},StyleFormatPanel.prototype.addSvgRule=function(t,e,n,i,l,s,o){var a=this.editorUi.editor.graph;if(o.test(e.selectorText)){var r=mxUtils.bind(this,function(e,o,r){if(""!=e.style[o]){var d=this.createColorOption(r+" "+e.selectorText,function(){return(t=(t=e.style[o]).match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):"";var t},function(t){l[s].style[o]=t;for(var e="",r=0;r<l.length;r++)e+=l[r].cssText+" ";i.textContent=e;var d=mxUtils.getXml(n.documentElement);a.setCellStyles(mxConstants.STYLE_IMAGE,"data:image/svg+xml,"+(window.btoa?btoa(d):Base64.encode(d,!0)),a.getSelectionCells())},"#ffffff",{install:function(t){},destroy:function(){}});t.appendChild(d),t.style.display=""}});r(e,"fill",mxResources.get("fill")),r(e,"stroke",mxResources.get("line"))}},StyleFormatPanel.prototype.addEditOps=function(t){var e=this.format.getSelectionState(),n=null;if(1==this.editorUi.editor.graph.getSelectionCount()&&((n=mxUtils.button(mxResources.get("editStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editStyle").funct()}))).setAttribute("title",mxResources.get("editStyle")+" ("+this.editorUi.actions.get("editStyle").shortcut+")"),n.style.width="202px",n.style.marginBottom="2px",t.appendChild(n)),e.image){var i=mxUtils.button(mxResources.get("editImage"),mxUtils.bind(this,function(t){this.editorUi.actions.get("image").funct()}));i.setAttribute("title",mxResources.get("editImage")),i.style.marginBottom="2px",null==n?i.style.width="202px":(n.style.width="100px",i.style.width="100px",i.style.marginLeft="2px"),t.appendChild(i)}return t},StyleFormatPanel.prototype.addFill=function(t){var e=this.editorUi.editor.graph,n=this.format.getSelectionState();t.style.paddingTop="6px",t.style.paddingBottom="6px";var i=document.createElement("select");i.style.position="absolute",i.style.marginTop="-2px",i.style.right=mxClient.IS_QUIRKS?"52px":"72px",i.style.width="70px",mxEvent.addListener(i,"click",function(t){mxEvent.consume(t)});var l=this.createCellColorOption(mxResources.get("gradient"),mxConstants.STYLE_GRADIENTCOLOR,"#ffffff",function(t){null==t||t==mxConstants.NONE?i.style.display="none":i.style.display=""}),s="image"==n.style.shape?mxConstants.STYLE_IMAGE_BACKGROUND:mxConstants.STYLE_FILLCOLOR,o="image"==n.style.shape?mxResources.get("background"):mxResources.get("fill"),a=this.createCellColorOption(o,s,"#ffffff");a.style.fontWeight="bold";var r=mxUtils.getValue(n.style,s,null);l.style.display=null!=r&&r!=mxConstants.NONE&&n.fill&&"image"!=n.style.shape?"":"none";for(var d=[mxConstants.DIRECTION_NORTH,mxConstants.DIRECTION_EAST,mxConstants.DIRECTION_SOUTH,mxConstants.DIRECTION_WEST],u=0;u<d.length;u++){var p=document.createElement("option");p.setAttribute("value",d[u]),mxUtils.write(p,mxResources.get(d[u])),i.appendChild(p)}l.appendChild(i);var m=mxUtils.bind(this,function(){n=this.format.getSelectionState();var e=mxUtils.getValue(n.style,mxConstants.STYLE_GRADIENT_DIRECTION,mxConstants.DIRECTION_SOUTH);""==e&&(e=mxConstants.DIRECTION_SOUTH),i.value=e,t.style.display=n.fill?"":"none";var s=mxUtils.getValue(n.style,mxConstants.STYLE_FILLCOLOR,null);!n.fill||n.containsImage||null==s||s==mxConstants.NONE||"filledEdge"==n.style.shape?l.style.display="none":l.style.display=""});e.getModel().addListener(mxEvent.CHANGE,m),this.listeners.push({destroy:function(){e.getModel().removeListener(m)}}),m(),mxEvent.addListener(i,"change",function(t){e.setCellStyles(mxConstants.STYLE_GRADIENT_DIRECTION,i.value,e.getSelectionCells()),mxEvent.consume(t)}),t.appendChild(a),t.appendChild(l);var c=this.getCustomColors();for(u=0;u<c.length;u++)t.appendChild(this.createCellColorOption(c[u].title,c[u].key,c[u].defaultValue));return t},StyleFormatPanel.prototype.getCustomColors=function(){var t=[];return"swimlane"==this.format.getSelectionState().style.shape&&t.push({title:mxResources.get("laneColor"),key:"swimlaneFillColor",defaultValue:"#ffffff"}),t},StyleFormatPanel.prototype.addStroke=function(t){var e=this.editorUi,n=e.editor.graph,i=this.format.getSelectionState();t.style.paddingTop="4px",t.style.paddingBottom="4px",t.style.whiteSpace="normal";var l=document.createElement("div");l.style.fontWeight="bold";var s=document.createElement("select");s.style.position="absolute",s.style.marginTop="-2px",s.style.right="72px",s.style.width="80px";for(var o=["sharp","rounded","curved"],a=0;a<o.length;a++){var r=document.createElement("option");r.setAttribute("value",o[a]),mxUtils.write(r,mxResources.get(o[a])),s.appendChild(r)}mxEvent.addListener(s,"change",function(t){n.getModel().beginUpdate();try{var i=[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],l=["0",null];"rounded"==s.value?l=["1",null]:"curved"==s.value&&(l=[null,"1"]);for(var o=0;o<i.length;o++)n.setCellStyles(i[o],l[o],n.getSelectionCells());e.fireEvent(new mxEventObject("styleChanged","keys",i,"values",l,"cells",n.getSelectionCells()))}finally{n.getModel().endUpdate()}mxEvent.consume(t)}),mxEvent.addListener(s,"click",function(t){mxEvent.consume(t)});var d="image"==i.style.shape?mxConstants.STYLE_IMAGE_BORDER:mxConstants.STYLE_STROKECOLOR,u="image"==i.style.shape?mxResources.get("border"):mxResources.get("line"),p=this.createCellColorOption(u,d,"#000000");p.appendChild(s),l.appendChild(p);var m=l.cloneNode(!1);m.style.fontWeight="normal",m.style.whiteSpace="nowrap",m.style.position="relative",m.style.paddingLeft="16px",m.style.marginBottom="2px",m.style.marginTop="2px",m.className="geToolbarContainer";mxUtils.bind(this,function(t,e,n,i,l){var s=this.editorUi.menus.styleChange(t,"",i,l,"geIcon",null),o=document.createElement("div");return o.style.width=e+"px",o.style.height="1px",o.style.borderBottom="1px "+n+" "+this.defaultStrokeColor,o.style.paddingTop="6px",s.firstChild.firstChild.style.padding="0px 4px 0px 4px",s.firstChild.firstChild.style.width=e+"px",s.firstChild.firstChild.appendChild(o),s});var c=m.cloneNode(!1),g=document.createElement("input");g.style.textAlign="right",g.style.marginTop="2px",g.style.width="41px",g.setAttribute("title",mxResources.get("linewidth")),m.appendChild(g);var h=g.cloneNode(!0);function x(t){var l=parseInt(g.value);(l=Math.min(999,Math.max(1,isNaN(l)?1:l)))!=mxUtils.getValue(i.style,mxConstants.STYLE_STROKEWIDTH,1)&&(n.setCellStyles(mxConstants.STYLE_STROKEWIDTH,l,n.getSelectionCells()),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[l],"cells",n.getSelectionCells()))),g.value=l+" pt",mxEvent.consume(t)}function y(t){var l=parseInt(h.value);(l=Math.min(999,Math.max(1,isNaN(l)?1:l)))!=mxUtils.getValue(i.style,mxConstants.STYLE_STROKEWIDTH,1)&&(n.setCellStyles(mxConstants.STYLE_STROKEWIDTH,l,n.getSelectionCells()),e.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_STROKEWIDTH],"values",[l],"cells",n.getSelectionCells()))),h.value=l+" pt",mxEvent.consume(t)}mxEvent.addListener(g,"blur",x),mxEvent.addListener(g,"change",x),mxEvent.addListener(h,"blur",y),mxEvent.addListener(h,"change",y),mxClient.IS_QUIRKS&&(mxUtils.br(c),mxUtils.br(c));var C=this.addArrow(pattern,9);C.className="geIcon",C.style.width="84px";var f=this.addArrow(altPattern,9);f.className="geIcon",f.style.width="22px";var E=document.createElement("div");E.style.width="85px",E.style.height="1px",E.style.borderBottom="1px solid "+this.defaultStrokeColor,E.style.marginBottom="9px",C.appendChild(E);var S=document.createElement("div");S.style.width="23px",S.style.height="1px",S.style.borderBottom="1px solid "+this.defaultStrokeColor,S.style.marginBottom="9px",f.appendChild(S),pattern.style.height="15px",altPattern.style.height="15px",edgeShape.style.height="15px",edgeStyle.style.height="17px",lineStart.style.marginLeft="3px",lineStart.style.height="17px",lineEnd.style.marginLeft="3px",lineEnd.style.height="17px";var v,L,b=m.cloneNode(!1);b.style.paddingBottom="6px",b.style.paddingTop="4px",b.style.fontWeight="normal",(_=document.createElement("div")).style.position="absolute",_.style.marginLeft="3px",_.style.marginBottom="12px",_.style.marginTop="2px",_.style.fontWeight="normal",_.style.width="76px",mxUtils.write(_,mxResources.get("lineend")),b.appendChild(_);var T=this.addUnitInput(b,"pt",74,33,function(){v.apply(this,arguments)}),U=this.addUnitInput(b,"pt",20,33,function(){L.apply(this,arguments)});mxUtils.br(b);var I,N,R=document.createElement("div");R.style.height="8px",b.appendChild(R),_=_.cloneNode(!1),mxUtils.write(_,mxResources.get("linestart")),b.appendChild(_);var A=this.addUnitInput(b,"pt",74,33,function(){I.apply(this,arguments)}),w=this.addUnitInput(b,"pt",20,33,function(){N.apply(this,arguments)});mxUtils.br(b),this.addLabel(b,mxResources.get("spacing"),74,50),this.addLabel(b,mxResources.get("size"),20,50),mxUtils.br(b);var _,M,O=l.cloneNode(!1);O.style.fontWeight="normal",O.style.position="relative",O.style.paddingLeft="16px",O.style.marginBottom="2px",O.style.marginTop="6px",O.style.borderWidth="0px",O.style.paddingBottom="18px",(_=document.createElement("div")).style.position="absolute",_.style.marginLeft="3px",_.style.marginBottom="12px",_.style.marginTop="1px",_.style.fontWeight="normal",_.style.width="120px",mxUtils.write(_,mxResources.get("perimeter")),O.appendChild(_);var P=this.addUnitInput(O,"pt",20,41,function(){M.apply(this,arguments)});i.edges.length==n.getSelectionCount()?(t.appendChild(c),mxClient.IS_QUIRKS&&(mxUtils.br(t),mxUtils.br(t)),t.appendChild(b)):i.vertices.length==n.getSelectionCount()&&(mxClient.IS_QUIRKS&&mxUtils.br(t),t.appendChild(O));var B=mxUtils.bind(this,function(t,n,l){i=this.format.getSelectionState();mxUtils.getValue(i.style,d,null);if(l||document.activeElement!=g){var o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_STROKEWIDTH,1));g.value=isNaN(o)?"":o+" pt"}if(l||document.activeElement!=h){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_STROKEWIDTH,1));h.value=isNaN(o)?"":o+" pt"}s.style.visibility="connector"==i.style.shape||"filledEdge"==i.style.shape?"":"hidden","1"==mxUtils.getValue(i.style,mxConstants.STYLE_CURVED,null)?s.value="curved":"1"==mxUtils.getValue(i.style,mxConstants.STYLE_ROUNDED,null)&&(s.value="rounded"),"1"==mxUtils.getValue(i.style,mxConstants.STYLE_DASHED,null)?null==mxUtils.getValue(i.style,mxConstants.STYLE_DASH_PATTERN,null)?E.style.borderBottom="1px dashed "+this.defaultStrokeColor:E.style.borderBottom="1px dotted "+this.defaultStrokeColor:E.style.borderBottom="1px solid "+this.defaultStrokeColor,S.style.borderBottom=E.style.borderBottom;var a=edgeStyle.getElementsByTagName("div")[0],r=mxUtils.getValue(i.style,mxConstants.STYLE_EDGE,null);"1"==mxUtils.getValue(i.style,mxConstants.STYLE_NOEDGESTYLE,null)&&(r=null),"orthogonalEdgeStyle"==r&&"1"==mxUtils.getValue(i.style,mxConstants.STYLE_CURVED,null)?a.className="geSprite geSprite-curved":a.className="straight"==r||"none"==r||null==r?"geSprite geSprite-straight":"entityRelationEdgeStyle"==r?"geSprite geSprite-entity":"elbowEdgeStyle"==r?"geSprite "+("vertical"==mxUtils.getValue(i.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalelbow":"geSprite-horizontalelbow"):"isometricEdgeStyle"==r?"geSprite "+("vertical"==mxUtils.getValue(i.style,mxConstants.STYLE_ELBOW,null)?"geSprite-verticalisometric":"geSprite-horizontalisometric"):"geSprite geSprite-orthogonal";var u=edgeShape.getElementsByTagName("div")[0];function p(t,n,l,s){var o=l.getElementsByTagName("div")[0];return o.className=e.getCssClassForMarker(s,i.style.shape,t,n),"geSprite geSprite-noarrow"==o.className&&(o.innerHTML=mxUtils.htmlEntities(mxResources.get("none")),o.style.backgroundImage="none",o.style.verticalAlign="top",o.style.marginTop="5px",o.style.fontSize="10px",o.style.filter="none",o.style.color=this.defaultStrokeColor,o.nextSibling.style.marginTop="0px"),o}"link"==i.style.shape?u.className="geSprite geSprite-linkedge":"flexArrow"==i.style.shape?u.className="geSprite geSprite-arrow":"arrow"==i.style.shape?u.className="geSprite geSprite-simplearrow":u.className="geSprite geSprite-connection";var m=p(mxUtils.getValue(i.style,mxConstants.STYLE_STARTARROW,null),mxUtils.getValue(i.style,"startFill","1"),lineStart,"start"),c=p(mxUtils.getValue(i.style,mxConstants.STYLE_ENDARROW,null),mxUtils.getValue(i.style,"endFill","1"),lineEnd,"end");if("arrow"==i.style.shape?(m.className="geSprite geSprite-noarrow",c.className="geSprite geSprite-endblocktrans"):"link"==i.style.shape&&(m.className="geSprite geSprite-noarrow",c.className="geSprite geSprite-noarrow"),mxUtils.setOpacity(edgeStyle,"arrow"==i.style.shape?30:100),"connector"!=i.style.shape&&"flexArrow"!=i.style.shape&&"filledEdge"!=i.style.shape?(mxUtils.setOpacity(lineStart,30),mxUtils.setOpacity(lineEnd,30)):(mxUtils.setOpacity(lineStart,100),mxUtils.setOpacity(lineEnd,100)),l||document.activeElement!=w){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE));w.value=isNaN(o)?"":o+" pt"}if(l||document.activeElement!=A){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0));A.value=isNaN(o)?"":o+" pt"}if(l||document.activeElement!=U){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE));U.value=isNaN(o)?"":o+" pt"}if(l||document.activeElement!=A){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0));T.value=isNaN(o)?"":o+" pt"}if(l||document.activeElement!=P){o=parseInt(mxUtils.getValue(i.style,mxConstants.STYLE_PERIMETER_SPACING,0));P.value=isNaN(o)?"":o+" pt"}});return N=this.installInputHandler(w,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),I=this.installInputHandler(A,mxConstants.STYLE_SOURCE_PERIMETER_SPACING,0,-999,999," pt"),L=this.installInputHandler(U,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE,0,999," pt"),v=this.installInputHandler(T,mxConstants.STYLE_TARGET_PERIMETER_SPACING,0,-999,999," pt"),M=this.installInputHandler(P,mxConstants.STYLE_PERIMETER_SPACING,0,0,999," pt"),this.addKeyHandler(g,B),this.addKeyHandler(w,B),this.addKeyHandler(A,B),this.addKeyHandler(U,B),this.addKeyHandler(T,B),this.addKeyHandler(P,B),n.getModel().addListener(mxEvent.CHANGE,B),this.listeners.push({destroy:function(){n.getModel().removeListener(B)}}),B(),t},StyleFormatPanel.prototype.addLineJumps=function(t){var e=this.format.getSelectionState();if(Graph.lineJumpsEnabled&&e.edges.length>0&&0==e.vertices.length&&e.lineJumps){t.style.padding="8px 0px 24px 18px";var n=this.editorUi,i=n.editor.graph,l=document.createElement("div");l.style.position="absolute",l.style.fontWeight="bold",l.style.width="80px",mxUtils.write(l,mxResources.get("lineJumps")),t.appendChild(l);var s=document.createElement("select");s.style.position="absolute",s.style.marginTop="-2px",s.style.right="76px",s.style.width="62px";for(var o,a=["none","arc","gap","sharp"],r=0;r<a.length;r++){var d=document.createElement("option");d.setAttribute("value",a[r]),mxUtils.write(d,mxResources.get(a[r])),s.appendChild(d)}mxEvent.addListener(s,"change",function(t){i.getModel().beginUpdate();try{i.setCellStyles("jumpStyle",s.value,i.getSelectionCells()),n.fireEvent(new mxEventObject("styleChanged","keys",["jumpStyle"],"values",[s.value],"cells",i.getSelectionCells()))}finally{i.getModel().endUpdate()}mxEvent.consume(t)}),mxEvent.addListener(s,"click",function(t){mxEvent.consume(t)}),t.appendChild(s);var u=this.addUnitInput(t,"pt",22,33,function(){o.apply(this,arguments)});o=this.installInputHandler(u,"jumpSize",Graph.defaultJumpSize,0,999," pt");var p=mxUtils.bind(this,function(t,n,i){if(e=this.format.getSelectionState(),s.value=mxUtils.getValue(e.style,"jumpStyle","none"),i||document.activeElement!=u){var l=parseInt(mxUtils.getValue(e.style,"jumpSize",Graph.defaultJumpSize));u.value=isNaN(l)?"":l+" pt"}});this.addKeyHandler(u,p),i.getModel().addListener(mxEvent.CHANGE,p),this.listeners.push({destroy:function(){i.getModel().removeListener(p)}}),p()}else t.style.display="none";return t},StyleFormatPanel.prototype.addEffects=function(t){var e=this.editorUi.editor.graph,n=this.format.getSelectionState();t.style.paddingTop="0px",t.style.paddingBottom="2px";var i=document.createElement("table");mxClient.IS_QUIRKS&&(i.style.fontSize="1em"),i.style.width="100%",i.style.fontWeight="bold",i.style.paddingRight="20px";var l=document.createElement("tbody"),s=document.createElement("tr");s.style.padding="0px";var o=document.createElement("td");o.style.padding="0px",o.style.width="50%",o.setAttribute("valign","top");var a=o.cloneNode(!0);a.style.paddingLeft="8px",s.appendChild(o),s.appendChild(a),l.appendChild(s),i.appendChild(l),t.appendChild(i);var r=o,d=0,u=mxUtils.bind(this,function(t,e,n){var i=this.createCellOption(t,e,n);i.style.width="100%",r.appendChild(i),r=r==o?a:o,d++}),p=mxUtils.bind(this,function(e,i,l){n=this.format.getSelectionState(),o.innerHTML="",a.innerHTML="",r=o,n.rounded&&u(mxResources.get("rounded"),mxConstants.STYLE_ROUNDED,0),"swimlane"==n.style.shape&&u(mxResources.get("divider"),"swimlaneLine",1),n.containsImage||u(mxResources.get("shadow"),mxConstants.STYLE_SHADOW,0),n.glass&&u(mxResources.get("glass"),mxConstants.STYLE_GLASS,0),n.comic&&u(mxResources.get("comic"),"comic",0),0==d&&(t.style.display="none")});return e.getModel().addListener(mxEvent.CHANGE,p),this.listeners.push({destroy:function(){e.getModel().removeListener(p)}}),p(),t},StyleFormatPanel.prototype.addStyleOps=function(t){t.style.paddingTop="10px",t.style.paddingBottom="10px";var e=mxUtils.button(mxResources.get("setAsDefaultStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("setAsDefaultStyle").funct()}));return e.setAttribute("title",mxResources.get("setAsDefaultStyle")+" ("+this.editorUi.actions.get("setAsDefaultStyle").shortcut+")"),e.style.width="202px",t.appendChild(e),t},DiagramFormatPanel=function(t,e,n){BaseFormatPanel.call(this,t,e,n),this.init()},mxUtils.extend(DiagramFormatPanel,BaseFormatPanel),DiagramFormatPanel.showPageView=!0,DiagramFormatPanel.prototype.showBackgroundImageOption=!0,DiagramFormatPanel.prototype.init=function(){var t=this.editorUi.editor.graph;this.container.appendChild(this.addView(this.createPanel())),t.isEnabled()&&(this.container.appendChild(this.addOptions(this.createPanel())),this.container.appendChild(this.addPaperSize(this.createPanel())),this.container.appendChild(this.addStyleOps(this.createPanel())))},DiagramFormatPanel.prototype.addView=function(t){var e=this.editorUi,n=e.editor.graph;if(t.appendChild(this.createTitle(mxResources.get("view"))),this.addGridOption(t),DiagramFormatPanel.showPageView&&t.appendChild(this.createOption(mxResources.get("pageView"),function(){return n.pageVisible},function(t){e.actions.get("pageView").funct()},{install:function(t){this.listener=function(){t(n.pageVisible)},e.addListener("pageViewChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}})),n.isEnabled()){var i=this.createColorOption(mxResources.get("background"),function(){return n.background},function(t){var i=new ChangePageSetup(e,t);i.ignoreImage=!0,n.model.execute(i)},"#ffffff",{install:function(t){this.listener=function(){t(n.background)},e.addListener("backgroundColorChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}});if(this.showBackgroundImageOption){var l=mxUtils.button(mxResources.get("image"),function(t){e.showBackgroundImageDialog(),mxEvent.consume(t)});l.style.position="absolute",l.className="geColorBtn",l.style.marginTop="-4px",l.style.paddingBottom=11==document.documentMode||mxClient.IS_MT?"0px":"2px",l.style.height="22px",l.style.right=mxClient.IS_QUIRKS?"52px":"72px",l.style.width="56px",i.appendChild(l)}t.appendChild(i)}return t},DiagramFormatPanel.prototype.addOptions=function(t){var e=this.editorUi,n=e.editor.graph;return t.appendChild(this.createTitle(mxResources.get("options"))),n.isEnabled()&&(t.appendChild(this.createOption(mxResources.get("connectionArrows"),function(){return n.connectionArrowsEnabled},function(t){e.actions.get("connectionArrows").funct()},{install:function(t){this.listener=function(){t(n.connectionArrowsEnabled)},e.addListener("connectionArrowsChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}})),t.appendChild(this.createOption(mxResources.get("connectionPoints"),function(){return n.connectionHandler.isEnabled()},function(t){e.actions.get("connectionPoints").funct()},{install:function(t){this.listener=function(){t(n.connectionHandler.isEnabled())},e.addListener("connectionPointsChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}})),t.appendChild(this.createOption(mxResources.get("guides"),function(){return n.graphHandler.guidesEnabled},function(t){e.actions.get("guides").funct()},{install:function(t){this.listener=function(){t(n.graphHandler.guidesEnabled)},e.addListener("guidesEnabledChanged",this.listener)},destroy:function(){e.removeListener(this.listener)}}))),t},DiagramFormatPanel.prototype.addGridOption=function(t){var e=this,n=this.editorUi,i=n.editor.graph,l=document.createElement("input");l.style.position="absolute",l.style.textAlign="right",l.style.width="38px",l.value=this.inUnit(i.getGridSize())+" "+this.getUnit();var s=this.createStepper(l,o,this.getUnitStep(),null,null,null,this.isFloatUnit());function o(t){var n=e.isFloatUnit()?parseFloat(l.value):parseInt(l.value);(n=e.fromUnit(Math.max(e.inUnit(1),isNaN(n)?e.inUnit(10):n)))!=i.getGridSize()&&i.setGridSize(n),l.value=e.inUnit(n)+" "+e.getUnit(),mxEvent.consume(t)}l.style.display=i.isGridEnabled()?"":"none",s.style.display=l.style.display,mxEvent.addListener(l,"keydown",function(t){13==t.keyCode?(i.container.focus(),mxEvent.consume(t)):27==t.keyCode&&(l.value=i.getGridSize(),i.container.focus(),mxEvent.consume(t))}),mxEvent.addListener(l,"blur",o),mxEvent.addListener(l,"change",o);var a=function(t,n){l.value=e.inUnit(i.getGridSize())+" "+e.getUnit(),e.format.refresh()};if(i.view.addListener("unitChanged",a),this.listeners.push({destroy:function(){i.view.removeListener(a)}}),mxClient.IS_SVG){l.style.marginTop="-2px",l.style.right="84px",s.style.marginTop="-16px",s.style.right="72px";var r=this.createColorOption(mxResources.get("grid"),function(){var t=i.view.gridColor;return i.isGridEnabled()?t:null},function(t){var e=i.isGridEnabled();t==mxConstants.NONE?i.setGridEnabled(!1):(i.setGridEnabled(!0),n.setGridColor(t)),l.style.display=i.isGridEnabled()?"":"none",s.style.display=l.style.display,e!=i.isGridEnabled()&&n.fireEvent(new mxEventObject("gridEnabledChanged"))},"#e0e0e0",{install:function(t){this.listener=function(){t(i.isGridEnabled()?i.view.gridColor:null)},n.addListener("gridColorChanged",this.listener),n.addListener("gridEnabledChanged",this.listener)},destroy:function(){n.removeListener(this.listener)}});r.appendChild(l),r.appendChild(s),t.appendChild(r)}else l.style.marginTop="2px",l.style.right="32px",s.style.marginTop="2px",s.style.right="20px",t.appendChild(l),t.appendChild(s),t.appendChild(this.createOption(mxResources.get("grid"),function(){return i.isGridEnabled()},function(t){i.setGridEnabled(t),i.isGridEnabled()&&(i.view.gridColor="#e0e0e0"),n.fireEvent(new mxEventObject("gridEnabledChanged"))},{install:function(t){this.listener=function(){l.style.display=i.isGridEnabled()?"":"none",s.style.display=l.style.display,t(i.isGridEnabled())},n.addListener("gridEnabledChanged",this.listener)},destroy:function(){n.removeListener(this.listener)}}))},DiagramFormatPanel.prototype.addDocumentProperties=function(t){this.editorUi.editor.graph;return t.appendChild(this.createTitle(mxResources.get("options"))),t},DiagramFormatPanel.prototype.addPaperSize=function(t){var e=this.editorUi,n=e.editor.graph;t.appendChild(this.createTitle(mxResources.get("paperSize")));var i=PageSetupDialog.addPageFormatPanel(t,"formatpanel",n.pageFormat,function(t){if(null==n.pageFormat||n.pageFormat.width!=t.width||n.pageFormat.height!=t.height){var i=new ChangePageSetup(e,null,null,t);i.ignoreColor=!0,i.ignoreImage=!0,n.model.execute(i)}});this.addKeyHandler(i.widthInput,function(){i.set(n.pageFormat)}),this.addKeyHandler(i.heightInput,function(){i.set(n.pageFormat)});var l=function(){i.set(n.pageFormat)};return e.addListener("pageFormatChanged",l),this.listeners.push({destroy:function(){e.removeListener(l)}}),n.getModel().addListener(mxEvent.CHANGE,l),this.listeners.push({destroy:function(){n.getModel().removeListener(l)}}),t},DiagramFormatPanel.prototype.addStyleOps=function(t){var e=mxUtils.button(mxResources.get("editData"),mxUtils.bind(this,function(t){this.editorUi.actions.get("editData").funct()}));return e.setAttribute("title",mxResources.get("editData")+" ("+this.editorUi.actions.get("editData").shortcut+")"),e.style.width="202px",e.style.marginBottom="2px",t.appendChild(e),mxUtils.br(t),(e=mxUtils.button(mxResources.get("clearDefaultStyle"),mxUtils.bind(this,function(t){this.editorUi.actions.get("clearDefaultStyle").funct()}))).setAttribute("title",mxResources.get("clearDefaultStyle")+" ("+this.editorUi.actions.get("clearDefaultStyle").shortcut+")"),e.style.width="202px",t.appendChild(e),t},DiagramFormatPanel.prototype.destroy=function(){BaseFormatPanel.prototype.destroy.apply(this,arguments),this.gridEnabledListener&&(this.editorUi.removeListener(this.gridEnabledListener),this.gridEnabledListener=null)};